<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wazuh SOC Use Cases Manager - Enhanced Edition</title>
    
    <!-- CodeMirror CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/dracula.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/shell/shell.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/yaml/yaml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/powershell/powershell.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/markdown/markdown.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Cytoscape -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.28.1/cytoscape.min.js"></script>
    
    <!-- DOMPurify for sanitization -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.8/purify.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #0a0e27;
            --bg-darker: #060817;
            --bg-light: #1a1f3a;
            --bg-card: #141829;
            --border: #2a3050;
            --primary: #00d4ff;
            --primary-dark: #0095b3;
            --secondary: #00ff88;
            --danger: #ff3366;
            --warning: #ffaa00;
            --text: #e4e4e7;
            --text-muted: #9ca3af;
            --success: #00ff88;
            --info: #00a6ff;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, var(--bg-darker) 0%, var(--bg-dark) 100%);
            color: var(--text);
            height: 100vh;
            overflow: hidden;
        }

        /* Main Layout */
        .app-container {
            display: flex;
            height: 100vh;
        }

        /* Sidebar Navigation */
        .sidebar {
            width: 280px;
            background: var(--bg-darker);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sidebar-header {
            padding: 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }

        .sidebar-header h1 {
            font-size: 1.2rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sidebar-search {
            padding: 15px;
            background: var(--bg-light);
            border-bottom: 1px solid var(--border);
        }

        .search-input {
            width: 100%;
            padding: 8px 12px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            font-size: 0.9rem;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(0, 212, 255, 0.2);
        }

        /* File Tree */
        .file-tree {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .tree-section {
            margin-bottom: 5px;
        }

        .tree-header {
            display: flex;
            align-items: center;
            padding: 8px 10px;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
            user-select: none;
        }

        .tree-header:hover {
            background: var(--bg-light);
        }

        .tree-header.expanded .tree-arrow {
            transform: rotate(90deg);
        }

        .tree-arrow {
            margin-right: 8px;
            transition: transform 0.2s;
            color: var(--text-muted);
        }

        .tree-icon {
            margin-right: 8px;
            font-size: 1.1rem;
        }

        .tree-label {
            flex: 1;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text);
        }

        .tree-count {
            background: var(--bg-light);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .tree-items {
            display: none;
            margin-left: 20px;
        }

        .tree-items.expanded {
            display: block;
        }

        .tree-item {
            display: flex;
            align-items: center;
            padding: 6px 10px;
            margin: 2px 0;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
            font-size: 0.85rem;
        }

        .tree-item:hover {
            background: var(--bg-light);
            transform: translateX(3px);
        }

        .tree-item.active {
            background: rgba(0, 212, 255, 0.1);
            border-left: 3px solid var(--primary);
        }

        .tree-item-icon {
            margin-right: 8px;
            opacity: 0.7;
        }

        .criticality-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-left: auto;
        }

        .criticality-dot.critical { background: var(--danger); }
        .criticality-dot.high { background: var(--warning); }
        .criticality-dot.medium { background: #ffd700; }
        .criticality-dot.low { background: var(--info); }
        .criticality-dot.info { background: var(--text-muted); }

        /* Main Content Area */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Header Bar */
        .header-bar {
            height: 60px;
            background: var(--bg-darker);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            padding: 0 20px;
            gap: 20px;
        }

        .tabs {
            display: flex;
            gap: 5px;
            flex: 1;
        }

        .tab {
            padding: 8px 16px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
            font-size: 0.9rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tab:hover {
            background: var(--bg-light);
            color: var(--text);
        }

        .tab.active {
            background: var(--primary);
            color: white;
        }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        /* Content Area */
        .content-wrapper {
            flex: 1;
            overflow-y: auto;
            background: var(--bg-dark);
        }

        .content-area {
            padding: 25px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Dashboard Styles */
        .dashboard-header {
            margin-bottom: 30px;
        }

        .dashboard-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .dashboard-subtitle {
            color: var(--text-muted);
        }

        /* Dashboard Filters */
        .dashboard-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-label {
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .filter-select {
            padding: 6px 12px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            font-size: 0.85rem;
            cursor: pointer;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
        }

        .metric-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 212, 255, 0.2);
        }

        .metric-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        .metric-icon.primary { background: rgba(0, 212, 255, 0.2); color: var(--primary); }
        .metric-icon.success { background: rgba(0, 255, 136, 0.2); color: var(--success); }
        .metric-icon.danger { background: rgba(255, 51, 102, 0.2); color: var(--danger); }
        .metric-icon.warning { background: rgba(255, 170, 0, 0.2); color: var(--warning); }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .metric-label {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .metric-change {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .metric-change.positive {
            background: rgba(0, 255, 136, 0.2);
            color: var(--success);
        }

        .metric-change.negative {
            background: rgba(255, 51, 102, 0.2);
            color: var(--danger);
        }

        /* Charts Container */
        .charts-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 1.1rem;
            font-weight: 600;
        }

        /* Table */
        .table-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
        }

        .table-card .content-wrapper {
            max-height: 600px;
            overflow-y: auto;
        }

        /* Grouped Tables */
        .platform-group {
            margin-bottom: 20px;
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
        }

        .platform-group-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 20px;
            background: var(--bg-light);
            cursor: pointer;
            user-select: none;
            transition: all 0.3s;
        }

        .platform-group-header:hover {
            background: rgba(0, 212, 255, 0.1);
        }

        .platform-group-header.collapsed .group-arrow {
            transform: rotate(-90deg);
        }

        .group-arrow {
            transition: transform 0.3s;
            margin-right: 10px;
            color: var(--text-muted);
        }

        .platform-icon {
            font-size: 1.2rem;
            margin-right: 10px;
        }

        .platform-name {
            flex: 1;
            font-weight: 600;
            text-transform: capitalize;
        }

        .platform-count {
            background: var(--bg-dark);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .platform-group-content {
            max-height: 400px;
            overflow-y: auto;
            transition: max-height 0.3s;
        }

        .platform-group-content.collapsed {
            max-height: 0;
            overflow: hidden;
        }

        .platform-group-content table {
            width: 100%;
            margin: 0;
        }

        .platform-stats {
            display: flex;
            gap: 15px;
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .platform-stats span {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .data-table {
            width: 100%;
            table-layout: fixed;
            border-collapse: collapse;
            min-width: 800px;
        }

        .data-table thead {
            position: sticky;
            top: 0;
            background: var(--bg-light);
            z-index: 10;
        }

        .data-table tbody {
            display: table-row-group;
        }

        .data-table tr {
            display: table-row;
        }

        /* Column widths */
        .data-table th:nth-child(1),
        .data-table td:nth-child(1) { width: 40px; }
        .data-table th:nth-child(2),
        .data-table td:nth-child(2) { width: 120px; }
        .data-table th:nth-child(3),
        .data-table td:nth-child(3) { width: 200px; }
        .data-table th:nth-child(4),
        .data-table td:nth-child(4) { width: 140px; }
        .data-table th:nth-child(5),
        .data-table td:nth-child(5) { width: 80px; }
        .data-table th:nth-child(6),
        .data-table td:nth-child(6) { width: 100px; }
        .data-table th:nth-child(7),
        .data-table td:nth-child(7) { width: 100px; }
        .data-table th:nth-child(8),
        .data-table td:nth-child(8) { width: 150px; }

        .table-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .data-table th {
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            font-size: 0.85rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid var(--border);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .data-table td {
            padding: 12px 8px;
            border-top: 1px solid var(--border);
            font-size: 0.9rem;
            vertical-align: middle;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .data-table th:nth-child(3),
        .data-table td:nth-child(3) {
            white-space: normal;
            word-wrap: break-word;
        }

        .data-table th:nth-child(1),
        .data-table td:nth-child(1),
        .data-table th:nth-child(5),
        .data-table td:nth-child(5),
        .data-table th:nth-child(6),
        .data-table td:nth-child(6),
        .data-table th:nth-child(7),
        .data-table td:nth-child(7) {
            text-align: center;
        }

        .data-table tbody tr {
            transition: all 0.2s;
        }

        .data-table tbody tr:hover {
            background: var(--bg-light);
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            padding: 20px;
            background: var(--bg-card);
            border-top: 1px solid var(--border);
        }

        .pagination-btn {
            padding: 8px 12px;
            background: var(--bg-light);
            border: 1px solid var(--border);
            color: var(--text);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .pagination-btn:hover:not(:disabled) {
            background: var(--primary);
            color: white;
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-info {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* Editor Sections */
        .editor-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            padding-bottom: 40px;
        }

        .editor-toolbar {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .editor-sections {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .editor-section {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .section-header {
            background: var(--bg-light);
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            cursor: pointer;
            user-select: none;
        }

        .section-header:hover {
            background: rgba(0, 212, 255, 0.1);
        }

        .section-title {
            flex: 1;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-toggle {
            transition: transform 0.3s;
        }

        .section-header.collapsed .section-toggle {
            transform: rotate(-90deg);
        }

        .section-content {
            padding: 20px;
            max-height: 600px;
            overflow-y: auto;
        }

        .section-content.collapsed {
            display: none;
        }

        .code-editor-wrapper {
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .CodeMirror {
            height: 300px;
            font-size: 14px;
        }

        /* Forms */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 0.9rem;
            color: var(--text);
        }

        .form-label .required {
            color: var(--danger);
        }

        .form-control {
            padding: 10px 12px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(0, 212, 255, 0.2);
        }

        textarea.form-control {
            resize: vertical;
            min-height: 100px;
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border-radius: 6px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #00cc6a 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #cc0033 100%);
            color: white;
        }

        .btn-secondary {
            background: var(--bg-light);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.85rem;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            padding: 25px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-light);
        }

        .modal-header h2 {
            font-size: 1.5rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .modal-body {
            padding: 25px;
        }

        .modal-footer {
            padding: 20px 25px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            background: var(--bg-light);
        }

        /* Badges */
        .badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-block;
        }

        .badge-critical {
            background: rgba(255, 51, 102, 0.2);
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        .badge-high {
            background: rgba(255, 170, 0, 0.2);
            color: var(--warning);
            border: 1px solid var(--warning);
        }

        .badge-medium {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
            border: 1px solid #ffd700;
        }

        .badge-low {
            background: rgba(0, 166, 255, 0.2);
            color: var(--info);
            border: 1px solid var(--info);
        }

        .badge-info {
            background: rgba(156, 163, 175, 0.2);
            color: var(--text-muted);
            border: 1px solid var(--text-muted);
        }

        .badge-deployed {
            background: rgba(0, 255, 136, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .badge-testing {
            background: rgba(0, 212, 255, 0.2);
            color: var(--primary);
            border: 1px solid var(--primary);
        }

        .badge-draft {
            background: rgba(156, 163, 175, 0.2);
            color: var(--text-muted);
            border: 1px solid var(--text-muted);
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            z-index: 2000;
            display: none;
            animation: slideInRight 0.3s;
            max-width: 400px;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast.show {
            display: block;
        }

        .toast.success {
            border-left: 3px solid var(--success);
        }

        .toast.error {
            border-left: 3px solid var(--danger);
        }

        .toast.info {
            border-left: 3px solid var(--primary);
        }

        .toast.warning {
            border-left: 3px solid var(--warning);
        }

        /* MITRE & Compliance specific styles */
        .mitre-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            padding: 20px;
        }

        .mitre-cell {
            background: var(--bg-light);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
        }

        .mitre-cell:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 212, 255, 0.3);
        }

        .mitre-cell.covered {
            background: rgba(0, 255, 136, 0.2);
            border-color: var(--success);
        }

        .mitre-tactic {
            font-weight: 600;
            font-size: 0.85rem;
            margin-bottom: 5px;
        }

        .mitre-count {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .compliance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .compliance-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
        }

        .compliance-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .compliance-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .compliance-percentage {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
        }

        .compliance-progress {
            height: 8px;
            background: var(--bg-light);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .compliance-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
            transition: width 0.5s ease;
        }

        .compliance-items {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .compliance-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
        }

        .compliance-check {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
        }

        .compliance-check.complete {
            background: rgba(0, 255, 136, 0.2);
            color: var(--success);
        }

        .compliance-check.partial {
            background: rgba(255, 170, 0, 0.2);
            color: var(--warning);
        }

        .compliance-check.missing {
            background: rgba(255, 51, 102, 0.2);
            color: var(--danger);
        }

        /* FAB */
        .fab-container {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 100;
        }

        .fab {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 212, 255, 0.3);
            transition: all 0.3s;
            border: none;
            font-size: 1.5rem;
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 212, 255, 0.5);
        }

        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--border);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-dark);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--bg-light);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--border);
        }

        /* Empty state */
        .empty-state {
            padding: 60px 40px;
            text-align: center;
            color: var(--text-muted);
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--text);
        }

        .empty-state p {
            margin-bottom: 30px;
        }

        .empty-state .btn {
            margin: 0 auto;
        }

        /* Export Modal Styles */
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .radio-option:hover {
            background: rgba(0, 212, 255, 0.1) !important;
            border-color: var(--primary) !important;
        }

        .radio-option:has(input:checked) {
            background: rgba(0, 212, 255, 0.2) !important;
            border-color: var(--primary) !important;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            transition: background 0.2s;
        }

        .checkbox-group label:hover {
            background: var(--bg-light);
        }

        .checkbox-group input[type="checkbox"] {
            margin-right: 8px;
        }

        .use-case-list {
            background: var(--bg-dark);
        }

        .use-case-list label:hover {
            background: rgba(0, 212, 255, 0.1);
        }

        #export-preview {
            max-height: 100px;
            overflow-y: auto;
        }
        /* Use Cases View Styles */
        .uc-view-filters {
            display: flex;
            gap: 15px;
            align-items: center;
            padding: 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            margin: 0 25px 25px 25px;
        }

        .uc-platform-section {
            margin: 0 25px 30px 25px;
        }

        .uc-platform-header {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 20px;
            background: linear-gradient(135deg, var(--bg-light) 0%, var(--bg-card) 100%);
            border: 1px solid var(--border);
            border-radius: 12px 12px 0 0;
            cursor: pointer;
            user-select: none;
        }

        .uc-platform-header:hover {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.1) 0%, var(--bg-card) 100%);
        }

        .uc-platform-icon {
            font-size: 1.5rem;
        }

        .uc-platform-name {
            flex: 1;
            font-size: 1.2rem;
            font-weight: 600;
            text-transform: capitalize;
        }

        .uc-platform-stats {
            display: flex;
            gap: 20px;
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .uc-cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            padding: 20px;
            background: var(--bg-darker);
            border: 1px solid var(--border);
            border-top: none;
            border-radius: 0 0 12px 12px;
        }

        .uc-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .uc-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
            transform: scaleX(0);
            transition: transform 0.3s;
        }

        .uc-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 212, 255, 0.2);
            border-color: var(--primary);
        }

        .uc-card:hover::before {
            transform: scaleX(1);
        }

        .uc-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .uc-card-id {
            font-weight: 700;
            color: var(--primary);
            font-size: 0.9rem;
            font-family: monospace;
        }

        .uc-card-badges {
            display: flex;
            gap: 8px;
        }

        .uc-card-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text);
        }

        .uc-card-description {
            color: var(--text-muted);
            font-size: 0.9rem;
            line-height: 1.5;
            margin-bottom: 15px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .uc-card-meta {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
        }

        .uc-card-meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .uc-card-meta-icon {
            color: var(--primary);
        }

        /* Detail Modal Styles */
        .uc-detail-section {
            margin-bottom: 25px;
            background: var(--bg-light);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
        }

        .uc-detail-section-header {
            padding: 15px 20px;
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .uc-detail-section-content {
            padding: 20px;
        }

        .uc-detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .uc-detail-field {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .uc-detail-label {
            font-size: 0.85rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .uc-detail-value {
            font-size: 1rem;
            color: var(--text);
            word-break: break-word;
        }

        .uc-detail-code {
            background: var(--bg-darker);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            font-family: monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            white-space: pre-wrap;
        }

        .uc-cards-grid.collapsed {
            display: none;
        }

        .uc-platform-header.collapsed .uc-platform-arrow {
            transform: rotate(-90deg);
        }

        .uc-platform-arrow {
            transition: transform 0.3s;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>üõ°Ô∏è Wazuh SOC Manager</h1>
            </div>
            
            <div class="sidebar-search">
                <input type="text" class="search-input" id="search-input" placeholder="Search use cases...">
            </div>

            <div class="file-tree" id="file-tree">
                <!-- Tree will be generated here -->
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header Bar -->
            <div class="header-bar">
                <div class="tabs">
                    <button class="tab active" data-tab="dashboard">
                        <span>üìä</span>
                        <span>Dashboard</span>
                    </button>
                    <button class="tab" data-tab="editor">
                        <span>‚úèÔ∏è</span>
                        <span>Editor</span>
                    </button>
                    <button class="tab" data-tab="compliance">
                        <span>‚úÖ</span>
                        <span>Compliance</span>
                    </button>
                    <button class="tab" data-tab="mitre">
                        <span>üéØ</span>
                        <span>MITRE ATT&CK</span>
                    </button>
                    <button class="tab" data-tab="usecases">
                        <span>üìö</span>
                        <span>Use Cases</span>
                    </button>
                </div>

                <div class="header-actions">
                    <button class="btn btn-secondary" onclick="app.importData()">
                        üì• Import
                    </button>
                    <button class="btn btn-secondary" onclick="app.showExportModal()">
                        üì§ Export
                    </button>
                    <button class="btn btn-primary" onclick="app.showCreateModal()">
                        ‚ûï New Use Case
                    </button>
                </div>
            </div>

            <!-- Content Wrapper -->
            <div class="content-wrapper">
                <!-- Dashboard View -->
                <div id="dashboard-view" class="content-area tab-content">
                    <div class="dashboard-header">
                        <h1 class="dashboard-title">Security Operations Center Dashboard</h1>
                        <p class="dashboard-subtitle">Real-time monitoring and analytics for Wazuh use cases</p>
                    </div>

                    <!-- Dashboard Filters -->
                    <div class="dashboard-filters">
                        <div class="filter-group">
                            <label class="filter-label">Platform:</label>
                            <select class="filter-select" id="filter-platform">
                                <option value="">All Platforms</option>
                                <option value="windows-workstation">Windows Workstation</option>
                                <option value="windows-server">Windows Server</option>
                                <option value="linux-systems">Linux Systems</option>
                                <option value="cloud-platforms">Cloud Platforms</option>
                                <option value="container-security">Container Security</option>
                                <option value="network-devices">Network Devices</option>
                                <option value="mobile-devices">Mobile Devices</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Criticality:</label>
                            <select class="filter-select" id="filter-criticality">
                                <option value="">All Levels</option>
                                <option value="critical">Critical</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                                <option value="info">Info</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Status:</label>
                            <select class="filter-select" id="filter-status">
                                <option value="">All Status</option>
                                <option value="deployed">Deployed</option>
                                <option value="testing">Testing</option>
                                <option value="draft">Draft</option>
                                <option value="disabled">Disabled</option>
                            </select>
                        </div>
                        <button class="btn btn-sm btn-primary" onclick="app.applyFilters()">Apply Filters</button>
                        <button class="btn btn-sm btn-secondary" onclick="app.resetFilters()">Reset</button>
                    </div>

                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-change positive">+12%</div>
                            <div class="metric-icon primary">üìã</div>
                            <div class="metric-value" id="metric-total">0</div>
                            <div class="metric-label">Total Use Cases</div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-change negative">‚ö†Ô∏è</div>
                            <div class="metric-icon danger">üö®</div>
                            <div class="metric-value" id="metric-critical">0</div>
                            <div class="metric-label">Critical Vulnerabilities</div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-change positive">+5</div>
                            <div class="metric-icon success">‚úÖ</div>
                            <div class="metric-value" id="metric-deployed">0</div>
                            <div class="metric-label">Deployed Rules</div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-icon warning">üéØ</div>
                            <div class="metric-value" id="metric-mitre">0%</div>
                            <div class="metric-label">MITRE Coverage</div>
                        </div>
                    </div>

                    <div class="charts-grid">
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3 class="chart-title">üìä Statistics Overview</h3>
                            </div>
                            <div id="stats-container" style="padding: 20px;">
                                <div class="stats-grid" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                                    <div class="stat-item" style="text-align: center; padding: 15px; background: rgba(0, 212, 255, 0.1); border-radius: 8px;">
                                        <div style="font-size: 2rem; font-weight: bold; color: var(--primary);" id="stat-active">0</div>
                                        <div style="color: var(--text-muted);">Active Cases</div>
                                    </div>
                                    <div class="stat-item" style="text-align: center; padding: 15px; background: rgba(0, 255, 136, 0.1); border-radius: 8px;">
                                        <div style="font-size: 2rem; font-weight: bold; color: var(--success);" id="stat-resolved">0</div>
                                        <div style="color: var(--text-muted);">Resolved</div>
                                    </div>
                                    <div class="stat-item" style="text-align: center; padding: 15px; background: rgba(255, 170, 0, 0.1); border-radius: 8px;">
                                        <div style="font-size: 2rem; font-weight: bold; color: var(--warning);" id="stat-pending">0</div>
                                        <div style="color: var(--text-muted);">In Testing</div>
                                    </div>
                                    <div class="stat-item" style="text-align: center; padding: 15px; background: rgba(255, 51, 102, 0.1); border-radius: 8px;">
                                        <div style="font-size: 2rem; font-weight: bold; color: var(--danger);" id="stat-critical">0</div>
                                        <div style="color: var(--text-muted);">Critical</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="chart-card">
                            <div class="chart-header">
                                <h3 class="chart-title">üéØ Criticality Breakdown</h3>
                            </div>
                            <div id="criticality-breakdown" style="padding: 20px;">
                                <div id="criticality-list" style="display: flex; flex-direction: column; gap: 10px;">
                                    <!-- Will be filled dynamically -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="table-card">
                        <div class="table-header">
                            <h3>üìã Recent Use Cases</h3>
                            <div style="display: flex; gap: 10px;">
                                <button class="btn btn-sm btn-secondary" onclick="app.toggleAllGroups()">
                                    üîÑ Expand/Collapse All
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="app.deleteSelected()" id="delete-selected-btn" style="display: none;">
                                    üóëÔ∏è Delete Selected (<span id="selected-count">0</span>)
                                </button>
                                <button class="btn btn-sm btn-secondary" onclick="app.refreshDashboard()">
                                    üîÑ Refresh
                                </button>
                            </div>
                        </div>
                        
                        <div id="grouped-tables-container" style="max-height: 600px; overflow-y: auto;">
                            <!-- Groups will be generated here -->
                        </div>
                        
                        <div class="pagination" style="border-top: 1px solid var(--border);">
                            <span class="pagination-info" id="global-stats">Total: 0 use cases across 0 platforms</span>
                        </div>
                    </div>
                </div>

                <!-- Editor View -->
                <div id="editor-view" class="content-area tab-content" style="display: none;">
                    <div class="editor-container">
                        <div class="editor-toolbar">
                            <button class="btn btn-primary" onclick="app.saveCurrentFile()">
                                üíæ Save
                            </button>
                            <button class="btn btn-secondary" onclick="app.formatDocument()">
                                ‚ú® Format
                            </button>
                            <button class="btn btn-secondary" onclick="app.exportSingleUseCase()">
                                üì§ Export This
                            </button>
                            <button class="btn btn-danger" onclick="app.deleteCurrentUseCase()">
                                üóëÔ∏è Delete This
                            </button>
                            <span style="margin-left: auto; color: var(--text-muted);" id="editor-info">
                                No file selected
                            </span>
                        </div>

                        <div class="editor-sections" id="editor-sections">
                            <div class="empty-state">
                                <h3>No Use Case Selected</h3>
                                <p>Select a use case from the sidebar to edit it, or create a new one.</p>
                                <button class="btn btn-primary" onclick="app.showCreateModal()">
                                    ‚ûï Create New Use Case
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Compliance View -->
                <div id="compliance-view" class="content-area tab-content" style="display: none;">
                    <div class="dashboard-header">
                        <h1 class="dashboard-title">Compliance Management</h1>
                        <p class="dashboard-subtitle">Track regulatory compliance across frameworks</p>
                    </div>
                    
                    <div class="compliance-grid" id="compliance-grid">
                        <!-- Compliance cards will be generated here -->
                    </div>
                </div>

                <!-- MITRE View -->
                <div id="mitre-view" class="content-area tab-content" style="display: none;">
                    <div class="dashboard-header">
                        <h1 class="dashboard-title">MITRE ATT&CK Coverage</h1>
                        <p class="dashboard-subtitle">Tactics and techniques detection coverage</p>
                    </div>
                    
                    <div class="chart-card">
                        <canvas id="mitre-radar" height="150"></canvas>
                    </div>
                    
                    <div class="mitre-grid" id="mitre-grid">
                        <!-- MITRE cells will be generated here -->
                    </div>
                </div>
                <!-- Use Cases View -->
                <div id="usecases-view" class="content-area tab-content" style="display: none;">
                    <div class="dashboard-header">
                        <h1 class="dashboard-title">üìö Use Cases Library</h1>
                        <p class="dashboard-subtitle">Browse and explore all security use cases by platform</p>
                    </div>
                    
                    <!-- Filter Bar -->
                    <div class="uc-view-filters">
                        <input type="text" id="uc-view-search" class="search-input" placeholder="üîç Search use cases..." style="max-width: 300px;">
                        <select id="uc-view-filter-platform" class="filter-select">
                            <option value="">All Platforms</option>
                            <option value="windows-workstation">Windows Workstation</option>
                            <option value="windows-server">Windows Server</option>
                            <option value="linux-systems">Linux Systems</option>
                            <option value="cloud-platforms">Cloud Platforms</option>
                            <option value="container-security">Container Security</option>
                            <option value="network-devices">Network Devices</option>
                            <option value="mobile-devices">Mobile Devices</option>
                        </select>
                        <select id="uc-view-filter-criticality" class="filter-select">
                            <option value="">All Criticality</option>
                            <option value="critical">Critical</option>
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                            <option value="info">Info</option>
                        </select>
                        <button class="btn btn-sm btn-primary" onclick="app.refreshUseCasesView()">
                            üîÑ Refresh
                        </button>
                    </div>
                    
                    <!-- Use Cases Container -->
                    <div id="uc-view-container">
                        <!-- Platform groups will be generated here -->
                    </div>
                </div>

                <!-- Use Case Detail Modal -->
                <div class="modal" id="uc-detail-modal">
                    <div class="modal-content" style="max-width: 90%; width: 1200px;">
                        <div class="modal-header">
                            <h2 id="uc-detail-title">Use Case Details</h2>
                            <button class="btn btn-sm btn-secondary" onclick="app.closeUseCaseDetail()" style="position: absolute; right: 20px; top: 20px;">‚úñ</button>
                        </div>
                        <div class="modal-body" id="uc-detail-body">
                            <!-- Details will be populated here -->
                        </div>
                        <div class="modal-footer">
                            <button class="btn btn-secondary" onclick="app.closeUseCaseDetail()">Close</button>
                            <button class="btn btn-primary" onclick="app.editFromDetail()">Edit in Editor</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Create/Edit Modal -->
    <div class="modal" id="create-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ûï Create New Use Case</h2>
            </div>
            <div class="modal-body">
                <form id="create-form">
                    <!-- Basic Information -->
                    <h3 style="margin-bottom: 15px; color: var(--primary);">üìã Basic Information</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Name <span class="required">*</span></label>
                            <input type="text" class="form-control" id="uc-name" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">CVE <span class="required">*</span></label>
                            <input type="text" class="form-control" id="uc-cve" placeholder="CVE-2024-XXXXX" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Platform</label>
                            <select class="form-control" id="uc-platform">
                                <option value="">Select...</option>
                                <option value="windows-workstation">Windows Workstation</option>
                                <option value="windows-server">Windows Server</option>
                                <option value="linux-systems">Linux Systems</option>
                                <option value="cloud-platforms">Cloud Platforms</option>
                                <option value="container-security">Container Security</option>
                                <option value="network-devices">Network Devices</option>
                                <option value="mobile-devices">Mobile Devices</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">MITRE Tactic</label>
                            <select class="form-control" id="uc-tactic">
                                <option value="">Select...</option>
                                <option value="initial-access">Initial Access</option>
                                <option value="execution">Execution</option>
                                <option value="persistence">Persistence</option>
                                <option value="privilege-escalation">Privilege Escalation</option>
                                <option value="defense-evasion">Defense Evasion</option>
                                <option value="credential-access">Credential Access</option>
                                <option value="discovery">Discovery</option>
                                <option value="lateral-movement">Lateral Movement</option>
                                <option value="collection">Collection</option>
                                <option value="command-and-control">Command and Control</option>
                                <option value="exfiltration">Exfiltration</option>
                                <option value="impact">Impact</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">MITRE Technique</label>
                            <input type="text" class="form-control" id="uc-technique" placeholder="T1003.001">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Criticality</label>
                            <select class="form-control" id="uc-criticality">
                                <option value="">Select...</option>
                                <option value="critical">üî¥ Critical</option>
                                <option value="high">üü† High</option>
                                <option value="medium">üü° Medium</option>
                                <option value="low">üîµ Low</option>
                                <option value="info">‚ö™ Info</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <select class="form-control" id="uc-status">
                                <option value="draft">üìù Draft</option>
                                <option value="testing">üß™ Testing</option>
                                <option value="deployed">‚úÖ Deployed</option>
                                <option value="disabled">‚õî Disabled</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">CVSS Score</label>
                            <input type="number" class="form-control" id="uc-cvss" min="0" max="10" step="0.1" placeholder="9.8">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Wazuh Rule ID</label>
                            <input type="text" class="form-control" id="uc-wazuh-id" placeholder="Auto-generated">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">False Positive Rate</label>
                            <select class="form-control" id="uc-fp-rate">
                                <option value="low">Low (< 5%)</option>
                                <option value="medium">Medium (5-15%)</option>
                                <option value="high">High (> 15%)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group" style="margin-top: 20px;">
                        <label class="form-label">Description</label>
                        <textarea class="form-control" id="uc-description" rows="3"></textarea>
                    </div>
                    
                    <!-- Detection Rules -->
                    <h3 style="margin: 20px 0 15px 0; color: var(--primary);">üîç Detection & Rules</h3>
                    
                    <div class="form-group">
                        <label class="form-label">Wazuh Rules (XML)</label>
                        <textarea class="form-control" id="uc-rules" rows="5" placeholder="<rule id='100001' level='10'>...</rule>"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Agent Configuration (XML)</label>
                        <textarea class="form-control" id="uc-agent-config" rows="5" placeholder="<agent_config>
  <localfile>
    <location>/var/log/custom.log</location>
    <log_format>syslog</log_format>
  </localfile>
</agent_config>"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Custom Decoders (XML/YAML)</label>
                        <textarea class="form-control" id="uc-decoders" rows="5" placeholder="<decoder name='custom_decoder'>
  <prematch>^Custom log:</prematch>
  <regex>^Custom log: (\S+) - (\S+)</regex>
  <order>user,action</order>
</decoder>"></textarea>
                    </div>
                    
                    <!-- Response & Scripts -->
                    <h3 style="margin: 20px 0 15px 0; color: var(--primary);">‚ö° Response & Automation</h3>
                    
                    <div class="form-group">
                        <label class="form-label">Response Actions</label>
                        <textarea class="form-control" id="uc-actions" rows="3" placeholder="1. Isolate affected system&#10;2. Block IP address&#10;3. Alert SOC team"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Active Response Script - Linux (Bash)</label>
                        <textarea class="form-control" id="uc-script-linux" rows="5" placeholder="#!/bin/bash
# Active response script for Linux
IP=$1
ACTION=$2

if [ '$ACTION' = 'add' ]; then
    iptables -I INPUT -s $IP -j DROP
elif [ '$ACTION' = 'delete' ]; then
    iptables -D INPUT -s $IP -j DROP
fi"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Active Response Script - Windows (PowerShell)</label>
                        <textarea class="form-control" id="uc-script-windows" rows="5" placeholder="# Active response script for Windows
param($IP, $Action)

if ($Action -eq 'add') {
    New-NetFirewallRule -DisplayName 'Wazuh Block' -RemoteAddress $IP -Action Block
} elseif ($Action -eq 'delete') {
    Remove-NetFirewallRule -DisplayName 'Wazuh Block'
}"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">VirusTotal Integration (Python)</label>
                        <textarea class="form-control" id="uc-virustotal" rows="5" placeholder="#!/usr/bin/env python3
import requests
import json

def check_hash_vt(file_hash):
    api_key = 'YOUR_VT_API_KEY'
    url = f'https://www.virustotal.com/api/v3/files/{file_hash}'
    headers = {'x-apikey': api_key}
    
    response = requests.get(url, headers=headers)
    return response.json()"></textarea>
                    </div>
                    
                    <!-- IOCs & Metadata -->
                    <h3 style="margin: 20px 0 15px 0; color: var(--primary);">üîç IOCs & Metadata</h3>
                    
                    <div class="form-group">
                        <label class="form-label">IOCs (Indicators of Compromise)</label>
                        <textarea class="form-control" id="uc-iocs" rows="3" placeholder="File hashes, IPs, domains, registry keys..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeModal()">Cancel</button>
                <button class="btn btn-primary" id="create-btn" onclick="app.createUseCase()">Create</button>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div class="modal" id="export-modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>üì§ Export Use Cases</h2>
            </div>
            <div class="modal-body">
                <div class="export-options">
                    <div class="form-group">
                        <label class="form-label">Export Type</label>
                        <div class="radio-group" style="display: flex; flex-direction: column; gap: 15px;">
                            <label class="radio-option" style="display: flex; align-items: center; padding: 15px; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 8px; cursor: pointer;">
                                <input type="radio" name="export-type" value="all" checked style="margin-right: 10px;">
                                <div>
                                    <strong>üìã Export All</strong>
                                    <div style="color: var(--text-muted); font-size: 0.85rem;">Export all use cases in a single file</div>
                                </div>
                            </label>
                            
                            <label class="radio-option" style="display: flex; align-items: center; padding: 15px; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 8px; cursor: pointer;">
                                <input type="radio" name="export-type" value="platform" style="margin-right: 10px;">
                                <div>
                                    <strong>üñ•Ô∏è Export by Platform</strong>
                                    <div style="color: var(--text-muted); font-size: 0.85rem;">Export use cases grouped by platform</div>
                                </div>
                            </label>
                            
                            <label class="radio-option" style="display: flex; align-items: center; padding: 15px; background: var(--bg-dark); border: 1px solid var(--border); border-radius: 8px; cursor: pointer;">
                                <input type="radio" name="export-type" value="individual" style="margin-right: 10px;">
                                <div>
                                    <strong>üìÑ Export Individual</strong>
                                    <div style="color: var(--text-muted); font-size: 0.85rem;">Export selected use cases individually</div>
                                </div>
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group" id="platform-selection" style="display: none;">
                        <label class="form-label">Select Platform(s)</label>
                        <div class="checkbox-group" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                            <label><input type="checkbox" value="windows-workstation"> üíª Windows Workstation</label>
                            <label><input type="checkbox" value="windows-server"> üñ•Ô∏è Windows Server</label>
                            <label><input type="checkbox" value="linux-systems"> üêß Linux Systems</label>
                            <label><input type="checkbox" value="cloud-platforms"> ‚òÅÔ∏è Cloud Platforms</label>
                            <label><input type="checkbox" value="container-security"> üê≥ Container Security</label>
                            <label><input type="checkbox" value="network-devices"> üåê Network Devices</label>
                            <label><input type="checkbox" value="mobile-devices"> üì± Mobile Devices</label>
                        </div>
                    </div>
                    
                    <div class="form-group" id="individual-selection" style="display: none;">
                        <label class="form-label">Select Use Cases</label>
                        <div class="use-case-list" style="max-height: 300px; overflow-y: auto; border: 1px solid var(--border); border-radius: 8px; padding: 10px;">
                            <!-- Will be populated dynamically -->
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Export Format Options</label>
                        <div class="checkbox-group">
                            <label><input type="checkbox" id="export-prettify" checked> üé® Prettify JSON</label>
                            <label><input type="checkbox" id="export-metadata" checked> üìä Include metadata</label>
                            <label><input type="checkbox" id="export-validate" checked> ‚úÖ Validate before export</label>
                            <label><input type="checkbox" id="export-compress"> üóúÔ∏è Compress (minify)</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Preview</label>
                        <div id="export-preview" style="background: var(--bg-dark); border: 1px solid var(--border); border-radius: 8px; padding: 15px; font-family: monospace; font-size: 0.85rem; color: var(--text-muted);">
                            Select export options to see preview...
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="app.closeExportModal()">Cancel</button>
                <button class="btn btn-primary" onclick="app.executeExport()">
                    <span>üì§</span> Export
                </button>
            </div>
        </div>
    </div>

    <!-- FAB -->
    <div class="fab-container">
        <button class="fab" onclick="app.showCreateModal()">‚ûï</button>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <script>
        /**
         * Wazuh SOC Manager Application - Corrected Version
         */
        class WazuhSOCApp {
            constructor() {
                this.db = null;
                this.currentFile = null;
                this.editors = {};
                this.charts = {};
                this.useCases = new Map();
                this.filteredUseCases = [];
                this.currentPage = 1;
                this.itemsPerPage = 10;
                this.isCreating = false;
                this.currentTab = 'dashboard';
                this.init();
            }

            /**
             * Initialize the application
             */
            async init() {
                console.log('üöÄ Initializing Wazuh SOC Manager...');
                
                try {
                    await this.initDB();
                    await this.loadSampleData();
                    this.setupEventListeners();
                    await this.renderFileTree();
                    await this.updateDashboard();
                    this.initializeDefaultView();
                    
                    console.log('‚úÖ Application initialized successfully');
                } catch (error) {
                    console.error('‚ùå Error initializing application:', error);
                    this.showToast('Error initializing application', 'error');
                }
            }

            /**
             * Initialize IndexedDB for persistent storage
             */
            async initDB() {
                return new Promise((resolve, reject) => {
                    if (this.db) {
                        this.db.close();
                    }
                    
                    const request = indexedDB.open('WazuhSOCDB', 5);
                    
                    request.onerror = () => reject(request.error);
                    
                    request.onsuccess = () => {
                        this.db = request.result;
                        console.log('‚úÖ Database connected');
                        resolve();
                    };
                    
                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        
                        if (!db.objectStoreNames.contains('usecases')) {
                            const store = db.createObjectStore('usecases', { keyPath: 'id' });
                            store.createIndex('platform', 'platform');
                            store.createIndex('criticality', 'criticality');
                            store.createIndex('status', 'status');
                            store.createIndex('created', 'created');
                        }
                        
                        if (!db.objectStoreNames.contains('history')) {
                            const historyStore = db.createObjectStore('history', { 
                                keyPath: 'id', 
                                autoIncrement: true 
                            });
                            historyStore.createIndex('usecase_id', 'usecase_id');
                            historyStore.createIndex('timestamp', 'timestamp');
                        }
                    };
                });
            }

            /**
             * Load sample data if database is empty
             */
            async loadSampleData() {
                const transaction = this.db.transaction(['usecases'], 'readwrite');
                const store = transaction.objectStore('usecases');
                
                const countRequest = store.count();
                countRequest.onsuccess = async () => {
                    if (countRequest.result === 0) {
                        const samples = [
                            {
                                id: 'WIN-CRED-001',
                                name: 'Mimikatz Detection',
                                platform: 'windows-workstation',
                                mitre_tactic: 'credential-access',
                                mitre_technique: 'T1003.001',
                                criticality: 'critical',
                                status: 'deployed',
                                wazuh_rule_id: '115001',
                                cve: 'CVE-2024-12345',
                                cvss: 9.8,
                                fp_rate: 'low',
                                description: 'Detection of Mimikatz credential dumping attempts on Windows systems',
                                rules: '<rule id="115001" level="10">\n  <decoded_as>windows</decoded_as>\n  <field name="win.eventdata.image">mimikatz.exe</field>\n  <description>Mimikatz execution detected</description>\n</rule>',
                                actions: '1. Isolate the affected system\n2. Reset all user passwords\n3. Investigate lateral movement\n4. Alert SOC team immediately',
                                iocs: 'Process: mimikatz.exe\nHash: 72a589da586844d7f0818ce684948eea\nRegistry: HKLM\\SECURITY\\Policy\\Secrets',
                                created: new Date().toISOString(),
                                modified: new Date().toISOString()
                            },
                            {
                                id: 'LIN-PRIV-001',
                                name: 'Sudo Privilege Escalation',
                                platform: 'linux-systems',
                                mitre_tactic: 'privilege-escalation',
                                mitre_technique: 'T1548.003',
                                criticality: 'high',
                                status: 'testing',
                                wazuh_rule_id: '125001',
                                cve: 'CVE-2024-67890',
                                cvss: 8.5,
                                fp_rate: 'medium',
                                description: 'Detection of sudo privilege escalation attempts',
                                created: new Date().toISOString(),
                                modified: new Date().toISOString()
                            }
                        ];
                        
                        for (const sample of samples) {
                            await this.saveUseCase(sample);
                        }
                        
                        console.log('‚úÖ Sample data loaded');
                    }
                };
            }

            /**
             * Setup event listeners - Simplified and cleaned up
             */
            setupEventListeners() {
                // Tab switching
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        const tabName = tab.dataset.tab;
                        this.switchTab(tabName);
                    });
                });

                // Search functionality
                const searchInput = document.getElementById('search-input');
                if (searchInput) {
                    searchInput.addEventListener('input', (e) => {
                        this.searchUseCases(e.target.value);
                    });
                }

                // Export modal listeners
                document.querySelectorAll('input[name="export-type"]').forEach(radio => {
                    radio.addEventListener('change', (e) => {
                        this.handleExportTypeChange(e.target.value);
                    });
                });

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    // Ctrl+N: New use case
                    if (e.ctrlKey && e.key === 'n') {
                        e.preventDefault();
                        this.showCreateModal();
                    }
                    
                    // Ctrl+S: Save current file
                    if (e.ctrlKey && e.key === 's') {
                        e.preventDefault();
                        if (this.currentFile) {
                            this.saveCurrentFile();
                        }
                    }
                    
                    // Escape: Close modal
                    if (e.key === 'Escape') {
                        this.closeAllModals();
                    }
                    
                    // Alt+1,2,3,4: Quick tab switching
                    if (e.altKey) {
                        const tabMap = {
                            '1': 'dashboard',
                            '2': 'editor',
                            '3': 'compliance',
                            '4': 'mitre'
                        };
                        
                        if (tabMap[e.key]) {
                            e.preventDefault();
                            this.switchTab(tabMap[e.key]);
                        }
                    }
                });

                console.log('‚úÖ Event listeners initialized');
            }

            /**
             * Initialize default view
             */
            initializeDefaultView() {
                this.switchTab('dashboard');
            }

            /**
             * Switch between tabs - Simplified and working
             */
            switchTab(tabName) {
                console.log(`üìë Switching to tab: ${tabName}`);
                
                const validTabs = ['dashboard', 'editor', 'compliance', 'mitre', 'usecases'];
                if (!validTabs.includes(tabName)) {
                    console.error('‚ùå Invalid tab name:', tabName);
                    return;
                }
                
                this.currentTab = tabName;
                
                // Update tab buttons
                document.querySelectorAll('.tab').forEach(tab => {
                    if (tab.dataset.tab === tabName) {
                        tab.classList.add('active');
                    } else {
                        tab.classList.remove('active');
                    }
                });
                
                // Hide all content areas
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.style.display = 'none';
                });
                
                // Show selected content area
                const targetView = document.getElementById(`${tabName}-view`);
                if (targetView) {
                    targetView.style.display = 'block';
                    
                    // Initialize specific views if needed
                    switch(tabName) {
                        case 'compliance':
                            this.initComplianceView();
                            break;
                            
                        case 'mitre':
                            this.initMitreView();
                            break;
                            
                        case 'editor':
                            if (!this.currentFile) {
                                this.showEditorEmptyState();
                            }
                            break;
                        case 'usecases':
                            this.initUseCasesView();
                            break;
                    }
                }
                
                console.log(`‚úÖ Switched to ${tabName}`);
            }

            /**
             * Show empty state for editor
             */
            showEditorEmptyState() {
                const editorSections = document.getElementById('editor-sections');
                if (editorSections) {
                    editorSections.innerHTML = `
                        <div class="empty-state">
                            <h3>No Use Case Selected</h3>
                            <p>Select a use case from the sidebar to edit it, or create a new one.</p>
                            <button class="btn btn-primary" onclick="app.showCreateModal()">
                                ‚ûï Create New Use Case
                            </button>
                        </div>
                    `;
                }
            }

            /**
             * Initialize compliance view with sample data
             */
            initComplianceView() {
                const grid = document.getElementById('compliance-grid');
                if (!grid) return;
                
                // Only initialize if empty
                if (grid.children.length > 0) return;
                
                const frameworks = [
                    { name: 'PCI-DSS', icon: 'üí≥', coverage: 87 },
                    { name: 'GDPR', icon: 'üîí', coverage: 92 },
                    { name: 'HIPAA', icon: 'üè•', coverage: 78 },
                    { name: 'SOX', icon: 'üìä', coverage: 85 },
                    { name: 'ISO 27001', icon: 'üìú', coverage: 90 },
                    { name: 'NIST', icon: 'üõ°Ô∏è', coverage: 83 }
                ];
                
                frameworks.forEach(fw => {
                    const card = document.createElement('div');
                    card.className = 'compliance-card';
                    card.innerHTML = `
                        <div class="compliance-header">
                            <div>
                                <span style="font-size: 2rem;">${fw.icon}</span>
                                <h3 class="compliance-title">${fw.name}</h3>
                            </div>
                            <div class="compliance-percentage">${fw.coverage}%</div>
                        </div>
                        <div class="compliance-progress">
                            <div class="compliance-progress-bar" style="width: ${fw.coverage}%"></div>
                        </div>
                        <div class="compliance-items">
                            <div class="compliance-item">
                                <span class="compliance-check complete">‚úî</span>
                                <span>Access Control</span>
                            </div>
                            <div class="compliance-item">
                                <span class="compliance-check complete">‚úî</span>
                                <span>Audit Logging</span>
                            </div>
                            <div class="compliance-item">
                                <span class="compliance-check partial">‚ö†</span>
                                <span>Encryption</span>
                            </div>
                        </div>
                    `;
                    grid.appendChild(card);
                });
                
                console.log('‚úÖ Compliance view initialized');
            }

            /**
             * Initialize MITRE view
             */
            initMitreView() {
                const tactics = [
                    'Initial Access', 'Execution', 'Persistence', 'Privilege Escalation',
                    'Defense Evasion', 'Credential Access', 'Discovery', 'Lateral Movement',
                    'Collection', 'Command and Control', 'Exfiltration', 'Impact'
                ];
                
                const grid = document.getElementById('mitre-grid');
                if (!grid) return;
                
                // Only initialize if empty
                if (grid.children.length > 0) return;
                
                tactics.forEach(tactic => {
                    const key = tactic.toLowerCase().replace(/ /g, '-');
                    const count = Array.from(this.useCases.values())
                        .filter(uc => uc.mitre_tactic === key).length;
                    
                    const cell = document.createElement('div');
                    cell.className = `mitre-cell ${count > 0 ? 'covered' : ''}`;
                    cell.innerHTML = `
                        <div class="mitre-tactic">${tactic}</div>
                        <div class="mitre-count">${count}</div>
                    `;
                    cell.title = `${count} use cases for ${tactic}`;
                    grid.appendChild(cell);
                });
                
                // Try to create radar chart if Chart.js is available
                const ctx = document.getElementById('mitre-radar');
                if (ctx && typeof Chart !== 'undefined') {
                    if (this.charts.mitre) {
                        this.charts.mitre.destroy();
                    }
                    
                    const data = tactics.map(tactic => {
                        const key = tactic.toLowerCase().replace(/ /g, '-');
                        return Array.from(this.useCases.values())
                            .filter(uc => uc.mitre_tactic === key).length;
                    });
                    
                    try {
                        this.charts.mitre = new Chart(ctx, {
                            type: 'radar',
                            data: {
                                labels: tactics,
                                datasets: [{
                                    label: 'Coverage',
                                    data: data,
                                    backgroundColor: 'rgba(0, 212, 255, 0.2)',
                                    borderColor: '#00d4ff',
                                    pointBackgroundColor: '#00d4ff',
                                    pointBorderColor: '#fff',
                                    pointHoverBackgroundColor: '#fff',
                                    pointHoverBorderColor: '#00d4ff'
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                scales: {
                                    r: {
                                        beginAtZero: true,
                                        grid: { color: '#2a3050' },
                                        ticks: { color: '#e4e4e7' }
                                    }
                                },
                                plugins: {
                                    legend: { display: false }
                                }
                            }
                        });
                    } catch (error) {
                        console.warn('Chart.js not available or error creating chart:', error);
                    }
                }
                
                console.log('‚úÖ MITRE view initialized');
            }

            /**
            * Initialize Use Cases view
            */
            initUseCasesView() {
                this.refreshUseCasesView();
                
                // Setup filters
                const searchInput = document.getElementById('uc-view-search');
                const platformFilter = document.getElementById('uc-view-filter-platform');
                const criticalityFilter = document.getElementById('uc-view-filter-criticality');
                
                if (searchInput) {
                    searchInput.addEventListener('input', () => this.filterUseCasesView());
                }
                if (platformFilter) {
                    platformFilter.addEventListener('change', () => this.filterUseCasesView());
                }
                if (criticalityFilter) {
                    criticalityFilter.addEventListener('change', () => this.filterUseCasesView());
                }
            }

            /**
            * Refresh Use Cases view
            */
            async refreshUseCasesView() {
                await this.loadAllUseCases();
                this.renderUseCasesView();
            }

            /**
            * Render Use Cases view
            */
            renderUseCasesView() {
                const container = document.getElementById('uc-view-container');
                if (!container) return;
                
                // Group use cases by platform
                const grouped = {};
                const platformIcons = {
                    'windows-workstation': 'üíª',
                    'windows-server': 'üñ•Ô∏è',
                    'linux-systems': 'üêß',
                    'cloud-platforms': '‚òÅÔ∏è',
                    'container-security': 'üê≥',
                    'network-devices': 'üåê',
                    'mobile-devices': 'üì±'
                };
                
                this.useCases.forEach(uc => {
                    const platform = uc.platform || 'unknown';
                    if (!grouped[platform]) {
                        grouped[platform] = [];
                    }
                    grouped[platform].push(uc);
                });
                
                container.innerHTML = '';
                
                // Create sections for each platform
                Object.keys(grouped).sort().forEach(platform => {
                    const section = document.createElement('div');
                    section.className = 'uc-platform-section';
                    section.dataset.platform = platform;
                    
                    // Platform header
                    const header = document.createElement('div');
                    header.className = 'uc-platform-header';
                    
                    const stats = {
                        total: grouped[platform].length,
                        critical: grouped[platform].filter(uc => uc.criticality === 'critical').length,
                        deployed: grouped[platform].filter(uc => uc.status === 'deployed').length
                    };
                    
                    header.innerHTML = `
                        <span class="uc-platform-arrow">‚ñº</span>
                        <span class="uc-platform-icon">${platformIcons[platform] || 'üìÅ'}</span>
                        <span class="uc-platform-name">${platform.replace(/-/g, ' ')}</span>
                        <div class="uc-platform-stats">
                            <span><strong>${stats.total}</strong> use cases</span>
                            <span><strong>${stats.critical}</strong> critical</span>
                            <span><strong>${stats.deployed}</strong> deployed</span>
                        </div>
                    `;
                    
                    // Cards grid
                    const grid = document.createElement('div');
                    grid.className = 'uc-cards-grid';
                    
                    // Sort use cases by criticality then by ID
                    const sortedUseCases = grouped[platform].sort((a, b) => {
                        const critOrder = { critical: 0, high: 1, medium: 2, low: 3, info: 4 };
                        const critDiff = (critOrder[a.criticality] || 5) - (critOrder[b.criticality] || 5);
                        if (critDiff !== 0) return critDiff;
                        return a.id.localeCompare(b.id);
                    });
                    
                    sortedUseCases.forEach(uc => {
                        const card = this.createUseCaseCard(uc);
                        grid.appendChild(card);
                    });
                    
                    // Toggle collapse
                    header.onclick = () => {
                        header.classList.toggle('collapsed');
                        grid.classList.toggle('collapsed');
                    };
                    
                    section.appendChild(header);
                    section.appendChild(grid);
                    container.appendChild(section);
                });
            }

            /**
            * Create use case card
            */
            createUseCaseCard(uc) {
                const card = document.createElement('div');
                card.className = 'uc-card';
                
                const truncateText = (text, maxLength) => {
                    if (!text) return 'N/A';
                    return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
                };
                
                card.innerHTML = `
                    <div class="uc-card-header">
                        <span class="uc-card-id">${uc.id}</span>
                        <div class="uc-card-badges">
                            <span class="badge badge-${uc.criticality}">${uc.criticality}</span>
                            <span class="badge badge-${uc.status}">${uc.status}</span>
                        </div>
                    </div>
                    <h3 class="uc-card-title">${uc.name}</h3>
                    <p class="uc-card-description">${truncateText(uc.description, 150)}</p>
                    <div class="uc-card-meta">
                        <div class="uc-card-meta-item">
                            <span class="uc-card-meta-icon">üîí</span>
                            <span>CVE: ${uc.cve || 'N/A'}</span>
                        </div>
                        <div class="uc-card-meta-item">
                            <span class="uc-card-meta-icon">üìä</span>
                            <span>CVSS: ${uc.cvss || 'N/A'}</span>
                        </div>
                        <div class="uc-card-meta-item">
                            <span class="uc-card-meta-icon">üéØ</span>
                            <span>${uc.mitre_tactic || 'No MITRE'}</span>
                        </div>
                        <div class="uc-card-meta-item">
                            <span class="uc-card-meta-icon">üìÖ</span>
                            <span>${new Date(uc.created).toLocaleDateString()}</span>
                        </div>
                    </div>
                `;
                
                card.onclick = () => this.showUseCaseDetail(uc.id);
                
                return card;
            }

            /**
            * Show use case detail
            */
            showUseCaseDetail(id) {
                const uc = this.useCases.get(id);
                if (!uc) return;
                
                this.currentDetailUseCase = uc;
                
                const modal = document.getElementById('uc-detail-modal');
                const title = document.getElementById('uc-detail-title');
                const body = document.getElementById('uc-detail-body');
                
                title.innerHTML = `üìã ${uc.id} - ${uc.name}`;
                
                body.innerHTML = `
                    <!-- Overview Section -->
                    <div class="uc-detail-section">
                        <div class="uc-detail-section-header">
                            <span>üìä</span> Overview
                        </div>
                        <div class="uc-detail-section-content">
                            <div class="uc-detail-grid">
                                <div class="uc-detail-field">
                                    <div class="uc-detail-label">ID</div>
                                    <div class="uc-detail-value">${uc.id}</div>
                                </div>
                                <div class="uc-detail-field">
                                    <div class="uc-detail-label">Name</div>
                                    <div class="uc-detail-value">${uc.name}</div>
                                </div>
                                <div class="uc-detail-field">
                                    <div class="uc-detail-label">Platform</div>
                                    <div class="uc-detail-value">${uc.platform}</div>
                                </div>
                                <div class="uc-detail-field">
                                    <div class="uc-detail-label">Status</div>
                                    <div class="uc-detail-value"><span class="badge badge-${uc.status}">${uc.status}</span></div>
                                </div>
                                <div class="uc-detail-field">
                                    <div class="uc-detail-label">Criticality</div>
                                    <div class="uc-detail-value"><span class="badge badge-${uc.criticality}">${uc.criticality}</span></div>
                                </div>
                                <div class="uc-detail-field">
                                    <div class="uc-detail-label">CVE</div>
                                    <div class="uc-detail-value">${uc.cve || 'N/A'}</div>
                                </div>
                                <div class="uc-detail-field">
                                    <div class="uc-detail-label">CVSS Score</div>
                                    <div class="uc-detail-value">${uc.cvss || 'N/A'}</div>
                                </div>
                                <div class="uc-detail-field">
                                    <div class="uc-detail-label">Wazuh Rule ID</div>
                                    <div class="uc-detail-value">${uc.wazuh_rule_id || 'N/A'}</div>
                                </div>
                            </div>
                            <div class="uc-detail-field" style="margin-top: 20px;">
                                <div class="uc-detail-label">Description</div>
                                <div class="uc-detail-value">${uc.description || 'No description provided'}</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- MITRE ATT&CK Section -->
                    <div class="uc-detail-section">
                        <div class="uc-detail-section-header">
                            <span>üéØ</span> MITRE ATT&CK Mapping
                        </div>
                        <div class="uc-detail-section-content">
                            <div class="uc-detail-grid">
                                <div class="uc-detail-field">
                                    <div class="uc-detail-label">Tactic</div>
                                    <div class="uc-detail-value">${uc.mitre_tactic || 'Not specified'}</div>
                                </div>
                                <div class="uc-detail-field">
                                    <div class="uc-detail-label">Technique</div>
                                    <div class="uc-detail-value">${uc.mitre_technique || 'Not specified'}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Detection Rules Section -->
                    ${uc.rules ? `
                    <div class="uc-detail-section">
                        <div class="uc-detail-section-header">
                            <span>üîç</span> Detection Rules
                        </div>
                        <div class="uc-detail-section-content">
                            <div class="uc-detail-code">${this.escapeHtml(uc.rules)}</div>
                        </div>
                    </div>
                    ` : ''}
                    
                    <!-- Response Actions Section -->
                    ${uc.actions ? `
                    <div class="uc-detail-section">
                        <div class="uc-detail-section-header">
                            <span>‚ö°</span> Response Actions
                        </div>
                        <div class="uc-detail-section-content">
                            <div class="uc-detail-value" style="white-space: pre-line;">${uc.actions}</div>
                        </div>
                    </div>
                    ` : ''}
                    
                    <!-- IOCs Section -->
                    ${uc.iocs ? `
                    <div class="uc-detail-section">
                        <div class="uc-detail-section-header">
                            <span>üîç</span> Indicators of Compromise
                        </div>
                        <div class="uc-detail-section-content">
                            <div class="uc-detail-value" style="white-space: pre-line;">${uc.iocs}</div>
                        </div>
                    </div>
                    ` : ''}
                    
                    <!-- Metadata Section -->
                    <div class="uc-detail-section">
                        <div class="uc-detail-section-header">
                            <span>üìÖ</span> Metadata
                        </div>
                        <div class="uc-detail-section-content">
                            <div class="uc-detail-grid">
                                <div class="uc-detail-field">
                                    <div class="uc-detail-label">Created</div>
                                    <div class="uc-detail-value">${new Date(uc.created).toLocaleString()}</div>
                                </div>
                                <div class="uc-detail-field">
                                    <div class="uc-detail-label">Modified</div>
                                    <div class="uc-detail-value">${new Date(uc.modified).toLocaleString()}</div>
                                </div>
                                <div class="uc-detail-field">
                                    <div class="uc-detail-label">False Positive Rate</div>
                                    <div class="uc-detail-value">${uc.fp_rate || 'Not specified'}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                modal.classList.add('active');
            }

            /**
            * Close use case detail modal
            */
            closeUseCaseDetail() {
                document.getElementById('uc-detail-modal').classList.remove('active');
                this.currentDetailUseCase = null;
            }

            /**
            * Edit from detail view
            */
            editFromDetail() {
                if (this.currentDetailUseCase) {
                    this.closeUseCaseDetail();
                    this.openUseCase(this.currentDetailUseCase.id);
                }
            }

            /**
            * Filter use cases view
            */
            filterUseCasesView() {
                const searchTerm = document.getElementById('uc-view-search').value.toLowerCase();
                const platformFilter = document.getElementById('uc-view-filter-platform').value;
                const criticalityFilter = document.getElementById('uc-view-filter-criticality').value;
                
                const sections = document.querySelectorAll('.uc-platform-section');
                
                sections.forEach(section => {
                    const platform = section.dataset.platform;
                    const cards = section.querySelectorAll('.uc-card');
                    let visibleCount = 0;
                    
                    // Filter platform level
                    if (platformFilter && platform !== platformFilter) {
                        section.style.display = 'none';
                        return;
                    }
                    
                    // Filter cards
                    cards.forEach(card => {
                        const cardText = card.textContent.toLowerCase();
                        const criticality = card.querySelector('.badge').textContent;
                        
                        let show = true;
                        
                        if (searchTerm && !cardText.includes(searchTerm)) {
                            show = false;
                        }
                        
                        if (criticalityFilter && criticality !== criticalityFilter) {
                            show = false;
                        }
                        
                        card.style.display = show ? '' : 'none';
                        if (show) visibleCount++;
                    });
                    
                    section.style.display = visibleCount > 0 ? '' : 'none';
                });
            }

            /**
            * Escape HTML for safe display
            */
            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            /**
             * Save use case to database
             */
            async saveUseCase(useCase, isUpdate = false) {
                return new Promise((resolve, reject) => {
                    const stores = ['usecases'];
                    if (this.db.objectStoreNames.contains('history')) {
                        stores.push('history');
                    }
                    
                    const transaction = this.db.transaction(stores, 'readwrite');
                    const store = transaction.objectStore('usecases');
                    
                    useCase = this.sanitizeUseCase(useCase);
                    
                    const request = store.put(useCase);
                    
                    request.onsuccess = () => {
                        this.useCases.set(useCase.id, useCase);
                        
                        if (stores.includes('history')) {
                            const historyStore = transaction.objectStore('history');
                            const historyEntry = {
                                usecase_id: useCase.id,
                                action: isUpdate ? 'updated' : 'created',
                                timestamp: new Date().toISOString(),
                                user: 'current_user'
                            };
                            historyStore.add(historyEntry);
                        }
                        
                        resolve();
                    };
                    request.onerror = () => reject(request.error);
                });
            }

            /**
             * Sanitize use case data to prevent XSS
             */
            sanitizeUseCase(useCase) {
                const textFields = ['name', 'description', 'actions', 'iocs'];
                const codeFields = ['rules', 'agent_config', 'decoders', 'script_linux', 'script_windows', 'virustotal'];
                
                textFields.forEach(field => {
                    if (useCase[field]) {
                        useCase[field] = DOMPurify.sanitize(useCase[field], { ALLOWED_TAGS: [] });
                    }
                });
                
                codeFields.forEach(field => {
                    if (useCase[field]) {
                        useCase[field] = useCase[field].replace(/<script>/gi, '&lt;script&gt;')
                                                      .replace(/<\/script>/gi, '&lt;/script&gt;');
                    }
                });
                
                return useCase;
            }

            /**
             * Load all use cases from database
             */
            async loadAllUseCases() {
                return new Promise((resolve, reject) => {
                    const transaction = this.db.transaction(['usecases'], 'readonly');
                    const store = transaction.objectStore('usecases');
                    const request = store.getAll();
                    
                    request.onsuccess = () => {
                        const useCases = request.result;
                        this.useCases.clear();
                        useCases.forEach(uc => this.useCases.set(uc.id, uc));
                        this.filteredUseCases = useCases;
                        resolve(useCases);
                    };
                    request.onerror = () => reject(request.error);
                });
            }

            /**
             * Open a use case in the editor
             */
            openUseCase(id) {
                const useCase = this.useCases.get(id);
                if (!useCase) {
                    this.showToast('Use case not found', 'error');
                    return;
                }
                
                this.currentFile = useCase;
                this.switchTab('editor');
                
                const editorInfo = document.getElementById('editor-info');
                if (editorInfo) {
                    editorInfo.textContent = `${useCase.id} - ${useCase.name}`;
                }
                
                this.createEditorSections(useCase);
                
                document.querySelectorAll('.tree-item').forEach(item => {
                    item.classList.remove('active');
                    if (item.textContent.includes(id)) {
                        item.classList.add('active');
                    }
                });
            }

            /**
             * Create editor sections for a use case
             */
            createEditorSections(useCase) {
                const container = document.getElementById('editor-sections');
                container.innerHTML = '';
                
                const sections = [
                    {
                        title: 'üìã Overview',
                        content: this.createOverviewSection(useCase),
                        collapsed: false
                    },
                    {
                        title: 'üîç Detection Rules',
                        content: this.createRulesSection(useCase),
                        code: true,
                        mode: 'xml',
                        field: 'rules',
                        collapsed: false
                    },
                    {
                        title: '‚öôÔ∏è Agent Configuration',
                        content: `<div class="code-editor-wrapper">
                            <textarea id="agent-config-editor">${useCase.agent_config || '<agent_config>\n  <!-- Add your agent configuration here -->\n</agent_config>'}</textarea>
                        </div>`,
                        code: true,
                        mode: 'xml',
                        field: 'agent_config',
                        collapsed: true
                    },
                    {
                        title: 'üîê Custom Decoders',
                        content: `<div class="code-editor-wrapper">
                            <textarea id="decoders-editor">${useCase.decoders || '<decoder name="custom_decoder">\n  <!-- Add your custom decoder here -->\n</decoder>'}</textarea>
                        </div>`,
                        code: true,
                        mode: 'xml',
                        field: 'decoders',
                        collapsed: true
                    },
                    {
                        title: '‚ö° Response Actions',
                        content: this.createActionsSection(useCase),
                        collapsed: false
                    }
                ];

                // Ajouter le script appropri√© selon la plateforme
                const platform = useCase.platform || '';
                const isWindows = platform.includes('windows');
                const isLinux = platform.includes('linux');
                const isCloud = platform.includes('cloud');
                const isContainer = platform.includes('container');
                const isNetwork = platform.includes('network');
                const isMobile = platform.includes('mobile');

                // Script Windows pour plateformes Windows
                if (isWindows) {
                    sections.push({
                        title: 'ü™ü Windows Script',
                        content: `<div class="code-editor-wrapper">
                            <textarea id="script-windows-editor">${useCase.script_windows || '# Active response script for Windows\n# Platform: ${platform}\n'}</textarea>
                        </div>`,
                        code: true,
                        mode: 'powershell',
                        field: 'script_windows',
                        collapsed: false
                    });
                }

                // Script Linux pour plateformes Linux, Cloud, Container
                if (isLinux || isCloud || isContainer) {
                    sections.push({
                        title: 'üêß Linux Script',
                        content: `<div class="code-editor-wrapper">
                            <textarea id="script-linux-editor">${useCase.script_linux || '#!/bin/bash\n# Active response script for ${platform}\n'}</textarea>
                        </div>`,
                        code: true,
                        mode: 'shell',
                        field: 'script_linux',
                        collapsed: false
                    });
                }

                // Pour les network devices, afficher les deux
                if (isNetwork) {
                    sections.push({
                        title: 'üêß Linux/Unix Script',
                        content: `<div class="code-editor-wrapper">
                            <textarea id="script-linux-editor">${useCase.script_linux || '#!/bin/bash\n# Script for network devices (Linux-based)\n'}</textarea>
                        </div>`,
                        code: true,
                        mode: 'shell',
                        field: 'script_linux',
                        collapsed: false
                    });
                    sections.push({
                        title: 'üîß Network CLI Script',
                        content: `<div class="code-editor-wrapper">
                            <textarea id="script-windows-editor">${useCase.script_windows || '# Network device configuration script\n'}</textarea>
                        </div>`,
                        code: true,
                        mode: 'shell',
                        field: 'script_windows',
                        collapsed: true
                    });
                }

                // Pour mobile
                if (isMobile) {
                    sections.push({
                        title: 'üì± Mobile Script',
                        content: `<div class="code-editor-wrapper">
                            <textarea id="script-linux-editor">${useCase.script_linux || '#!/bin/bash\n# Mobile device management script\n'}</textarea>
                        </div>`,
                        code: true,
                        mode: 'shell',
                        field: 'script_linux',
                        collapsed: false
                    });
                }

                // Ajouter les sections finales
                sections.push(
                    {
                        title: 'ü¶† VirusTotal Integration',
                        content: `<div class="code-editor-wrapper">
                            <textarea id="virustotal-editor">${useCase.virustotal || '#!/usr/bin/env python3\n# VirusTotal integration script\n'}</textarea>
                        </div>`,
                        code: true,
                        mode: 'python',
                        field: 'virustotal',
                        collapsed: true
                    },
                    {
                        title: 'üîç IOCs',
                        content: `<div class="form-group">
                            <label class="form-label">Indicators of Compromise</label>
                            <textarea class="form-control" rows="6" data-field="iocs">${useCase.iocs || ''}</textarea>
                        </div>`,
                        collapsed: true
                    },
                    {
                        title: 'üéØ MITRE Mapping',
                        content: this.createMitreSection(useCase),
                        collapsed: false
                    }
                );
                
                this.editors = {};
                
                sections.forEach(section => {
                    const sectionEl = document.createElement('div');
                    sectionEl.className = 'editor-section';
                    
                    const header = document.createElement('div');
                    header.className = `section-header ${section.collapsed ? 'collapsed' : ''}`;
                    header.innerHTML = `
                        <div class="section-title">
                            <span>${section.title}</span>
                        </div>
                        <span class="section-toggle">‚ñº</span>
                    `;
                    
                    const content = document.createElement('div');
                    content.className = `section-content ${section.collapsed ? 'collapsed' : ''}`;
                    content.innerHTML = section.content;
                    
                    if (section.code) {
                        const textarea = content.querySelector('textarea');
                        if (textarea) {
                            setTimeout(() => {
                                const editor = CodeMirror.fromTextArea(textarea, {
                                    mode: section.mode || 'xml',
                                    theme: 'dracula',
                                    lineNumbers: true,
                                    lineWrapping: true
                                });
                                this.editors[section.field] = editor;
                            }, 100);
                        }
                    }
                    
                    header.onclick = () => {
                        header.classList.toggle('collapsed');
                        content.classList.toggle('collapsed');
                    };
                    
                    sectionEl.appendChild(header);
                    sectionEl.appendChild(content);
                    container.appendChild(sectionEl);
                    // Ajouter ceci ICI :
                    setTimeout(() => {
                        this.refreshEditorOnPlatformChange();
                    }, 200); 
                });
            }

                        /**
            * Refresh editor sections when platform changes
            */
            refreshEditorOnPlatformChange() {
                const platformSelect = document.querySelector('[data-field="platform"]');
                if (platformSelect && this.currentFile) {
                    platformSelect.addEventListener('change', (e) => {
                        this.saveCurrentFile();
                        this.currentFile.platform = e.target.value;
                        this.createEditorSections(this.currentFile);
                        this.showToast('Editor updated for platform: ' + e.target.value, 'info');
                    });
                }
            }

            createOverviewSection(uc) {
                return `
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">ID</label>
                            <input class="form-control" value="${uc.id}" readonly>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Name</label>
                            <input class="form-control" value="${uc.name}" data-field="name">
                        </div>
                        <div class="form-group">
                            <label class="form-label">CVE</label>
                            <input class="form-control" value="${uc.cve || ''}" data-field="cve">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Platform</label>
                            <select class="form-control" data-field="platform">
                                <option value="windows-workstation" ${uc.platform === 'windows-workstation' ? 'selected' : ''}>Windows Workstation</option>
                                <option value="windows-server" ${uc.platform === 'windows-server' ? 'selected' : ''}>Windows Server</option>
                                <option value="linux-systems" ${uc.platform === 'linux-systems' ? 'selected' : ''}>Linux Systems</option>
                                <option value="cloud-platforms" ${uc.platform === 'cloud-platforms' ? 'selected' : ''}>Cloud Platforms</option>
                                <option value="container-security" ${uc.platform === 'container-security' ? 'selected' : ''}>Container Security</option>
                                <option value="network-devices" ${uc.platform === 'network-devices' ? 'selected' : ''}>Network Devices</option>
                                <option value="mobile-devices" ${uc.platform === 'mobile-devices' ? 'selected' : ''}>Mobile Devices</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <select class="form-control" data-field="status">
                                <option value="draft" ${uc.status === 'draft' ? 'selected' : ''}>Draft</option>
                                <option value="testing" ${uc.status === 'testing' ? 'selected' : ''}>Testing</option>
                                <option value="deployed" ${uc.status === 'deployed' ? 'selected' : ''}>Deployed</option>
                                <option value="disabled" ${uc.status === 'disabled' ? 'selected' : ''}>Disabled</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Criticality</label>
                            <select class="form-control" data-field="criticality">
                                <option value="critical" ${uc.criticality === 'critical' ? 'selected' : ''}>Critical</option>
                                <option value="high" ${uc.criticality === 'high' ? 'selected' : ''}>High</option>
                                <option value="medium" ${uc.criticality === 'medium' ? 'selected' : ''}>Medium</option>
                                <option value="low" ${uc.criticality === 'low' ? 'selected' : ''}>Low</option>
                                <option value="info" ${uc.criticality === 'info' ? 'selected' : ''}>Info</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">CVSS Score</label>
                            <input type="number" class="form-control" value="${uc.cvss || ''}" data-field="cvss" min="0" max="10" step="0.1">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Wazuh Rule ID</label>
                            <input class="form-control" value="${uc.wazuh_rule_id || ''}" data-field="wazuh_rule_id">
                        </div>
                        <div class="form-group">
                            <label class="form-label">False Positive Rate</label>
                            <select class="form-control" data-field="fp_rate">
                                <option value="low" ${uc.fp_rate === 'low' ? 'selected' : ''}>Low (< 5%)</option>
                                <option value="medium" ${uc.fp_rate === 'medium' ? 'selected' : ''}>Medium (5-15%)</option>
                                <option value="high" ${uc.fp_rate === 'high' ? 'selected' : ''}>High (> 15%)</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea class="form-control" rows="3" data-field="description">${uc.description || ''}</textarea>
                    </div>
                `;
            }

            createRulesSection(uc) {
                return `
                    <div class="code-editor-wrapper">
                        <textarea id="rules-editor">${uc.rules || '<rule id="100000" level="10">\n  <!-- Add your Wazuh rule here -->\n</rule>'}</textarea>
                    </div>
                `;
            }

            createActionsSection(uc) {
                return `
                    <div class="form-group">
                        <label class="form-label">Response Actions</label>
                        <textarea class="form-control" rows="6" data-field="actions">${uc.actions || '1. Isolate affected system\n2. Collect forensic data\n3. Alert SOC team\n4. Document incident'}</textarea>
                    </div>
                `;
            }

            createMitreSection(uc) {
                return `
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Tactic</label>
                            <input class="form-control" value="${uc.mitre_tactic || ''}" data-field="mitre_tactic">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Technique</label>
                            <input class="form-control" value="${uc.mitre_technique || ''}" data-field="mitre_technique">
                        </div>
                    </div>
                `;
            }

            /**
             * Render file tree in sidebar
             */
            async renderFileTree() {
                const useCases = await this.loadAllUseCases();
                const tree = document.getElementById('file-tree');
                
                const grouped = {};
                const platformIcons = {
                    'windows-workstation': 'üíª',
                    'windows-server': 'üñ•Ô∏è',
                    'linux-systems': 'üêß',
                    'cloud-platforms': '‚òÅÔ∏è',
                    'container-security': 'üê≥',
                    'network-devices': 'üåê',
                    'mobile-devices': 'üì±'
                };
                
                useCases.forEach(uc => {
                    if (!grouped[uc.platform]) {
                        grouped[uc.platform] = [];
                    }
                    grouped[uc.platform].push(uc);
                });
                
                tree.innerHTML = '';
                
                Object.keys(grouped).sort().forEach(platform => {
                    const section = document.createElement('div');
                    section.className = 'tree-section';
                    
                    const header = document.createElement('div');
                    header.className = 'tree-header expanded';
                    header.innerHTML = `
                        <span class="tree-arrow">‚ñ∂</span>
                        <span class="tree-icon">${platformIcons[platform] || 'üìÅ'}</span>
                        <span class="tree-label">${platform.replace('-', ' ').toUpperCase()}</span>
                        <span class="tree-count">${grouped[platform].length}</span>
                    `;
                    
                    const items = document.createElement('div');
                    items.className = 'tree-items expanded';
                    
                    grouped[platform].sort((a, b) => a.id.localeCompare(b.id)).forEach(uc => {
                        const item = document.createElement('div');
                        item.className = 'tree-item';
                        item.innerHTML = `
                            <span class="tree-item-icon">üìÑ</span>
                            <span>${uc.id}</span>
                            <span class="criticality-dot ${uc.criticality}"></span>
                        `;
                        item.onclick = () => this.openUseCase(uc.id);
                        items.appendChild(item);
                    });
                    
                    header.onclick = () => {
                        header.classList.toggle('expanded');
                        items.classList.toggle('expanded');
                    };
                    
                    section.appendChild(header);
                    section.appendChild(items);
                    tree.appendChild(section);
                });
            }

            /**
             * Update dashboard metrics and charts
             */
            async updateDashboard() {
                const useCases = await this.loadAllUseCases();
                
                // Update metrics
                document.getElementById('metric-total').textContent = useCases.length;
                document.getElementById('metric-critical').textContent = 
                    useCases.filter(uc => uc.criticality === 'critical').length;
                document.getElementById('metric-deployed').textContent = 
                    useCases.filter(uc => uc.status === 'deployed').length;
                
                const mitreTactics = new Set(useCases.map(uc => uc.mitre_tactic).filter(Boolean));
                const coverage = Math.round((mitreTactics.size / 12) * 100);
                document.getElementById('metric-mitre').textContent = coverage + '%';
                
                this.updateTable();
                this.updateCharts(useCases);
            }

            /**
             * Update dashboard charts
             */
            updateCharts(useCases) {
                const stats = {
                    active: useCases.filter(uc => uc.status === 'deployed').length,
                    resolved: useCases.filter(uc => uc.status === 'disabled').length,
                    pending: useCases.filter(uc => uc.status === 'testing').length,
                    critical: useCases.filter(uc => uc.criticality === 'critical').length
                };
                
                document.getElementById('stat-active').textContent = stats.active;
                document.getElementById('stat-resolved').textContent = stats.resolved;
                document.getElementById('stat-pending').textContent = stats.pending;
                document.getElementById('stat-critical').textContent = stats.critical;
                
                const critCount = {
                    critical: useCases.filter(uc => uc.criticality === 'critical').length,
                    high: useCases.filter(uc => uc.criticality === 'high').length,
                    medium: useCases.filter(uc => uc.criticality === 'medium').length,
                    low: useCases.filter(uc => uc.criticality === 'low').length,
                    info: useCases.filter(uc => uc.criticality === 'info').length
                };
                
                const critList = document.getElementById('criticality-list');
                if (critList) {
                    critList.innerHTML = '';
                    
                    const critColors = {
                        critical: '#ff3366',
                        high: '#ffaa00',
                        medium: '#ffd700',
                        low: '#00a6ff',
                        info: '#9ca3af'
                    };
                    
                    Object.entries(critCount).forEach(([level, count]) => {
                        const total = useCases.length || 1;
                        const percentage = Math.round((count / total) * 100);
                        
                        const item = document.createElement('div');
                        item.style.cssText = 'display: flex; align-items: center; gap: 10px;';
                        item.innerHTML = `
                            <div style="width: 12px; height: 12px; border-radius: 50%; background: ${critColors[level]};"></div>
                            <div style="flex: 1; text-transform: capitalize;">${level}</div>
                            <div style="font-weight: bold;">${count}</div>
                            <div style="color: var(--text-muted);">(${percentage}%)</div>
                            <div style="flex: 1; height: 4px; background: var(--bg-dark); border-radius: 2px; overflow: hidden;">
                                <div style="width: ${percentage}%; height: 100%; background: ${critColors[level]};"></div>
                            </div>
                        `;
                        critList.appendChild(item);
                    });
                }
            }

            /**
             * Update table with platform grouping
             */
            updateTable() {
                const container = document.getElementById('grouped-tables-container');
                if (!container) return;
                
                const grouped = {};
                const platformIcons = {
                    'windows-workstation': 'üíª',
                    'windows-server': 'üñ•Ô∏è',
                    'linux-systems': 'üêß',
                    'cloud-platforms': '‚òÅÔ∏è',
                    'container-security': 'üê≥',
                    'network-devices': 'üåê',
                    'mobile-devices': 'üì±'
                };
                
                this.filteredUseCases.forEach(uc => {
                    if (!grouped[uc.platform]) {
                        grouped[uc.platform] = [];
                    }
                    grouped[uc.platform].push(uc);
                });
                
                container.innerHTML = '';
                
                Object.keys(grouped).sort().forEach(platform => {
                    const platformUseCases = grouped[platform];
                    
                    const groupDiv = document.createElement('div');
                    groupDiv.className = 'platform-group';
                    groupDiv.dataset.platform = platform;
                    
                    const header = document.createElement('div');
                    header.className = 'platform-group-header';
                    header.innerHTML = `
                        <span class="group-arrow">‚ñº</span>
                        <span class="platform-icon">${platformIcons[platform] || 'üìÅ'}</span>
                        <span class="platform-name">${platform.replace('-', ' ')}</span>
                        <div class="platform-stats">
                            <span><span class="badge badge-deployed">${platformUseCases.filter(uc => uc.status === 'deployed').length}</span> Deployed</span>
                            <span><span class="badge badge-testing">${platformUseCases.filter(uc => uc.status === 'testing').length}</span> Testing</span>
                            <span><span class="badge badge-critical">${platformUseCases.filter(uc => uc.criticality === 'critical').length}</span> Critical</span>
                        </div>
                        <span class="platform-count">${platformUseCases.length} items</span>
                    `;
                    
                    const content = document.createElement('div');
                    content.className = 'platform-group-content';
                    
                    const table = document.createElement('table');
                    table.className = 'data-table';
                    table.innerHTML = `
                        <thead>
                            <tr>
                                <th><input type="checkbox" class="group-select-all" data-platform="${platform}" onchange="app.toggleGroupSelection('${platform}')"></th>
                                <th>ID</th>
                                <th>Name</th>
                                <th>CVE</th>
                                <th>CVSS</th>
                                <th>Criticality</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                    `;
                    
                    const sortedUseCases = platformUseCases.sort((a, b) => {
                        const critOrder = { critical: 0, high: 1, medium: 2, low: 3, info: 4 };
                        const critDiff = (critOrder[a.criticality] || 5) - (critOrder[b.criticality] || 5);
                        if (critDiff !== 0) return critDiff;
                        return a.id.localeCompare(b.id);
                    });
                    
                    sortedUseCases.forEach(uc => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td><input type="checkbox" class="row-checkbox" data-id="${uc.id}" data-platform="${platform}" onchange="app.updateSelectionCount()"></td>
                            <td><strong>${uc.id}</strong></td>
                            <td>${uc.name}</td>
                            <td><span style="font-family: monospace; font-size: 0.85rem;">${uc.cve || 'N/A'}</span></td>
                            <td>${uc.cvss ? `<span class="badge" style="background: ${this.getCVSSColor(uc.cvss)};">${uc.cvss}</span>` : 'N/A'}</td>
                            <td><span class="badge badge-${uc.criticality}">${uc.criticality}</span></td>
                            <td><span class="badge badge-${uc.status}">${uc.status}</span></td>
                            <td>
                                <button class="btn btn-sm btn-primary" onclick="app.openUseCase('${uc.id}')">Edit</button>
                                <button class="btn btn-sm btn-danger" onclick="app.deleteUseCase('${uc.id}')">Delete</button>
                            </td>
                        `;
                        table.querySelector('tbody').appendChild(row);
                    });
                    
                    table.innerHTML += '</tbody>';
                    content.appendChild(table);
                    
                    header.onclick = () => {
                        header.classList.toggle('collapsed');
                        content.classList.toggle('collapsed');
                    };
                    
                    groupDiv.appendChild(header);
                    groupDiv.appendChild(content);
                    container.appendChild(groupDiv);
                });
                
                const totalUseCases = this.filteredUseCases.length;
                const platformCount = Object.keys(grouped).length;
                document.getElementById('global-stats').textContent = 
                    `Total: ${totalUseCases} use cases across ${platformCount} platforms`;
            }

            /**
             * Get CVSS score color
             */
            getCVSSColor(score) {
                if (score >= 9.0) return 'var(--danger)';
                if (score >= 7.0) return 'var(--warning)';
                if (score >= 4.0) return '#ffd700';
                if (score >= 0.1) return 'var(--info)';
                return 'var(--text-muted)';
            }

            /**
             * Show create modal
             */
            showCreateModal() {
                document.getElementById('create-modal').classList.add('active');
                document.getElementById('create-btn').disabled = false;
                this.isCreating = false;
            }

            /**
             * Close all modals
             */
            closeAllModals() {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.classList.remove('active');
                });
                this.isCreating = false;
            }

            /**
             * Close modal
             */
            closeModal() {
                document.getElementById('create-modal').classList.remove('active');
                document.getElementById('create-form').reset();
                this.isCreating = false;
            }

            /**
             * Close export modal
             */
            closeExportModal() {
                document.getElementById('export-modal').classList.remove('active');
            }

            /**
             * Generate use case ID
             */
            generateUseCaseId(platform, tactic) {
                const platformPrefix = {
                    'windows-workstation': 'WIN',
                    'windows-server': 'WSRV',
                    'linux-systems': 'LIN',
                    'cloud-platforms': 'CLD',
                    'container-security': 'CNT',
                    'network-devices': 'NET',
                    'mobile-devices': 'MOB'
                }[platform] || 'GEN';
                
                const tacticPrefix = {
                    'initial-access': 'IA',
                    'execution': 'EX',
                    'persistence': 'PERS',
                    'privilege-escalation': 'PRIV',
                    'defense-evasion': 'DEF',
                    'credential-access': 'CRED',
                    'discovery': 'DISC',
                    'lateral-movement': 'LAT',
                    'collection': 'COLL',
                    'command-and-control': 'C2',
                    'exfiltration': 'EXFIL',
                    'impact': 'IMP'
                }[tactic] || 'GEN';
                
                let nextNum = 1;
                this.useCases.forEach((uc, id) => {
                    if (id.startsWith(`${platformPrefix}-${tacticPrefix}-`)) {
                        const num = parseInt(id.split('-').pop());
                        if (num >= nextNum) nextNum = num + 1;
                    }
                });
                
                return `${platformPrefix}-${tacticPrefix}-${String(nextNum).padStart(3, '0')}`;
            }

            /**
             * Generate Wazuh rule ID
             */
            generateWazuhRuleId(platform) {
                const baseId = {
                    'windows-workstation': 110000,
                    'windows-server': 120000,
                    'linux-systems': 130000,
                    'cloud-platforms': 140000,
                    'container-security': 150000,
                    'network-devices': 160000,
                    'mobile-devices': 170000
                }[platform] || 100000;
                
                let nextId = baseId;
                this.useCases.forEach(uc => {
                    if (uc.wazuh_rule_id && parseInt(uc.wazuh_rule_id) >= nextId) {
                        nextId = parseInt(uc.wazuh_rule_id) + 1;
                    }
                });
                
                return String(nextId);
            }

            /**
             * Create new use case
             */
            async createUseCase() {
                if (this.isCreating) return;
                
                const name = document.getElementById('uc-name').value.trim();
                const cve = document.getElementById('uc-cve').value.trim();
                const platform = document.getElementById('uc-platform').value || 'windows-workstation';
                const tactic = document.getElementById('uc-tactic').value || 'execution';
                const criticality = document.getElementById('uc-criticality').value || 'medium';
                const status = document.getElementById('uc-status').value || 'draft';
                
                if (!name || !cve) {
                    this.showToast('Name and CVE are required fields', 'error');
                    return;
                }
                
                const existingUC = Array.from(this.useCases.values()).find(uc => uc.cve === cve);
                if (existingUC) {
                    this.showToast(`CVE ${cve} already exists in ${existingUC.id}`, 'warning');
                    return;
                }
                
                this.isCreating = true;
                const createBtn = document.getElementById('create-btn');
                createBtn.disabled = true;
                createBtn.innerHTML = '<span class="loading"></span> Creating...';
                
                const id = this.generateUseCaseId(platform, tactic);
                
                const useCase = {
                    id,
                    name,
                    platform,
                    mitre_tactic: tactic,
                    mitre_technique: document.getElementById('uc-technique').value || '',
                    criticality,
                    status,
                    cve,
                    cvss: parseFloat(document.getElementById('uc-cvss').value) || 0,
                    wazuh_rule_id: document.getElementById('uc-wazuh-id').value || this.generateWazuhRuleId(platform),
                    fp_rate: document.getElementById('uc-fp-rate').value || 'low',
                    description: document.getElementById('uc-description').value || '',
                    rules: document.getElementById('uc-rules').value || '',
                    agent_config: document.getElementById('uc-agent-config').value || '',
                    decoders: document.getElementById('uc-decoders').value || '',
                    script_linux: document.getElementById('uc-script-linux').value || '',
                    script_windows: document.getElementById('uc-script-windows').value || '',
                    virustotal: document.getElementById('uc-virustotal').value || '',
                    actions: document.getElementById('uc-actions').value || '',
                    iocs: document.getElementById('uc-iocs').value || '',
                    created: new Date().toISOString(),
                    modified: new Date().toISOString()
                };
                
                try {
                    await this.saveUseCase(useCase);
                    await this.renderFileTree();
                    await this.updateDashboard();
                    this.closeModal();
                    this.openUseCase(id);
                    this.showToast(`Use case ${id} created successfully!`, 'success');
                } catch (error) {
                    console.error('Error creating use case:', error);
                    this.showToast('Error: ' + error.message, 'error');
                } finally {
                    this.isCreating = false;
                    createBtn.disabled = false;
                    createBtn.innerHTML = 'Create';
                }
            }

            /**
             * Delete use case
             */
            async deleteUseCase(id) {
                const useCase = this.useCases.get(id);
                if (!useCase) {
                    this.showToast('Use case not found', 'error');
                    return;
                }
                
                if (confirm(`Delete use case ${id}?\n\nThis action cannot be undone!`)) {
                    try {
                        const transaction = this.db.transaction(['usecases'], 'readwrite');
                        const store = transaction.objectStore('usecases');
                        const deleteRequest = store.delete(id);
                        
                        deleteRequest.onsuccess = async () => {
                            this.useCases.delete(id);
                            await this.renderFileTree();
                            await this.updateDashboard();
                            
                            if (this.currentFile && this.currentFile.id === id) {
                                this.currentFile = null;
                                this.showEditorEmptyState();
                            }
                            
                            this.showToast(`Use case ${id} deleted successfully`, 'success');
                        };
                        
                        deleteRequest.onerror = () => {
                            this.showToast(`Error deleting ${id}`, 'error');
                        };
                    } catch (error) {
                        console.error('Delete error:', error);
                        this.showToast(`Error: ${error.message}`, 'error');
                    }
                }
            }

            /**
             * Save current file in editor
             */
            saveCurrentFile() {
                if (!this.currentFile) {
                    this.showToast('No file selected', 'warning');
                    return;
                }
                
                document.querySelectorAll('[data-field]').forEach(field => {
                    const fieldName = field.dataset.field;
                    this.currentFile[fieldName] = field.value;
                });
                
                Object.keys(this.editors).forEach(field => {
                    if (this.editors[field]) {
                        this.currentFile[field] = this.editors[field].getValue();
                    }
                });
                // Sauvegarder aussi les champs des textareas simples (non-CodeMirror)
                const textareas = document.querySelectorAll('textarea[data-field]');
                textareas.forEach(textarea => {
                    const fieldName = textarea.dataset.field;
                    this.currentFile[fieldName] = textarea.value;
                });
                
                this.currentFile.modified = new Date().toISOString();
                this.saveUseCase(this.currentFile, true);
                this.showToast('Saved successfully!', 'success');
            }

            /**
             * Apply dashboard filters
             */
            async applyFilters() {
                const platform = document.getElementById('filter-platform').value;
                const criticality = document.getElementById('filter-criticality').value;
                const status = document.getElementById('filter-status').value;
                
                let filtered = Array.from(this.useCases.values());
                
                if (platform) {
                    filtered = filtered.filter(uc => uc.platform === platform);
                }
                if (criticality) {
                    filtered = filtered.filter(uc => uc.criticality === criticality);
                }
                if (status) {
                    filtered = filtered.filter(uc => uc.status === status);
                }
                
                this.filteredUseCases = filtered;
                this.currentPage = 1;
                this.updateTable();
                this.showToast(`Filtered: ${filtered.length} use cases found`, 'info');
            }

            /**
             * Reset dashboard filters
             */
            resetFilters() {
                document.getElementById('filter-platform').value = '';
                document.getElementById('filter-criticality').value = '';
                document.getElementById('filter-status').value = '';
                this.filteredUseCases = Array.from(this.useCases.values());
                this.currentPage = 1;
                this.updateTable();
                this.showToast('Filters reset', 'info');
            }

            /**
             * Refresh dashboard
             */
            async refreshDashboard() {
                await this.updateDashboard();
                this.showToast('Dashboard refreshed', 'info');
            }

            /**
             * Toggle all platform groups
             */
            toggleAllGroups() {
                const headers = document.querySelectorAll('.platform-group-header');
                const contents = document.querySelectorAll('.platform-group-content');
                
                const hasCollapsed = Array.from(headers).some(h => h.classList.contains('collapsed'));
                
                headers.forEach(header => {
                    if (hasCollapsed) {
                        header.classList.remove('collapsed');
                    } else {
                        header.classList.add('collapsed');
                    }
                });
                
                contents.forEach(content => {
                    if (hasCollapsed) {
                        content.classList.remove('collapsed');
                    } else {
                        content.classList.add('collapsed');
                    }
                });
            }

            /**
             * Toggle group selection
             */
            toggleGroupSelection(platform) {
                const groupCheckbox = document.querySelector(`.group-select-all[data-platform="${platform}"]`);
                const rowCheckboxes = document.querySelectorAll(`.row-checkbox[data-platform="${platform}"]`);
                
                rowCheckboxes.forEach(cb => {
                    cb.checked = groupCheckbox.checked;
                });
                
                this.updateSelectionCount();
            }

            /**
             * Update selection count
             */
            updateSelectionCount() {
                const checked = document.querySelectorAll('.row-checkbox:checked');
                const count = checked.length;
                
                const deleteBtn = document.getElementById('delete-selected-btn');
                const countSpan = document.getElementById('selected-count');
                
                if (deleteBtn) {
                    deleteBtn.style.display = count > 0 ? 'inline-flex' : 'none';
                }
                if (countSpan) {
                    countSpan.textContent = count;
                }
            }

            /**
             * Delete selected use cases
             */
            async deleteSelected() {
                const checked = document.querySelectorAll('.row-checkbox:checked');
                const ids = Array.from(checked).map(cb => cb.dataset.id);
                
                if (ids.length === 0) return;
                
                if (confirm(`Delete ${ids.length} selected use cases?\n\nThis action cannot be undone!`)) {
                    let deleted = 0;
                    
                    for (const id of ids) {
                        try {
                            const transaction = this.db.transaction(['usecases'], 'readwrite');
                            const store = transaction.objectStore('usecases');
                            await new Promise((resolve, reject) => {
                                const request = store.delete(id);
                                request.onsuccess = () => {
                                    this.useCases.delete(id);
                                    deleted++;
                                    resolve();
                                };
                                request.onerror = () => reject();
                            });
                        } catch (e) {
                            console.error(`Error deleting ${id}:`, e);
                        }
                    }
                    
                    await this.renderFileTree();
                    await this.updateDashboard();
                    this.showToast(`Deleted ${deleted} use cases`, 'success');
                }
            }

            /**
             * Delete current use case
             */
            async deleteCurrentUseCase() {
                if (!this.currentFile) {
                    this.showToast('No use case selected', 'warning');
                    return;
                }
                
                await this.deleteUseCase(this.currentFile.id);
                this.switchTab('dashboard');
            }

            /**
             * Format document
             */
            formatDocument() {
                Object.values(this.editors).forEach(editor => {
                    const content = editor.getValue();
                    if (content.includes('<')) {
                        const formatted = content
                            .replace(/>\s*</g, '>\n<')
                            .replace(/\n{3,}/g, '\n\n');
                        editor.setValue(formatted);
                    }
                });
                this.showToast('Document formatted', 'info');
            }

            /**
             * Export single use case
             */
            exportSingleUseCase() {
                if (!this.currentFile) {
                    this.showToast('No use case selected', 'warning');
                    return;
                }
                
                const dataStr = JSON.stringify(this.currentFile, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `${this.currentFile.id}-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                this.showToast(`Exported ${this.currentFile.id}`, 'success');
            }

            /**
             * Show export modal
             */
            showExportModal() {
                const modal = document.getElementById('export-modal');
                modal.classList.add('active');
                this.populateIndividualSelection();
                this.updateExportPreview();
            }

            /**
             * Handle export type change
             */
            handleExportTypeChange(type) {
                document.getElementById('platform-selection').style.display = 'none';
                document.getElementById('individual-selection').style.display = 'none';
                
                if (type === 'platform') {
                    document.getElementById('platform-selection').style.display = 'block';
                } else if (type === 'individual') {
                    document.getElementById('individual-selection').style.display = 'block';
                }
                
                this.updateExportPreview();
            }

            /**
             * Populate individual selection
             */
            populateIndividualSelection() {
                const container = document.querySelector('.use-case-list');
                if (!container) return;
                
                const grouped = {};
                this.useCases.forEach(uc => {
                    if (!grouped[uc.platform]) grouped[uc.platform] = [];
                    grouped[uc.platform].push(uc);
                });
                
                let html = '';
                Object.keys(grouped).sort().forEach(platform => {
                    html += `<div style="margin-bottom: 15px;">`;
                    html += `<div style="font-weight: 600; margin-bottom: 5px; color: var(--primary);">${platform.replace('-', ' ').toUpperCase()}</div>`;
                    
                    grouped[platform].forEach(uc => {
                        html += `
                            <label style="display: flex; align-items: center; padding: 5px; cursor: pointer;">
                                <input type="checkbox" value="${uc.id}" style="margin-right: 8px;">
                                <span style="flex: 1;">${uc.id} - ${uc.name}</span>
                            </label>
                        `;
                    });
                    html += `</div>`;
                });
                
                container.innerHTML = html;
            }

            /**
             * Update export preview
             */
            updateExportPreview() {
                const preview = document.getElementById('export-preview');
                const exportType = document.querySelector('input[name="export-type"]:checked').value;
                
                let previewText = '';
                let count = 0;
                
                if (exportType === 'all') {
                    count = this.useCases.size;
                    previewText = `Will export ${count} use cases in a single file`;
                } else if (exportType === 'platform') {
                    const selected = Array.from(document.querySelectorAll('#platform-selection input:checked'))
                        .map(cb => cb.value);
                    if (selected.length > 0) {
                        count = Array.from(this.useCases.values())
                            .filter(uc => selected.includes(uc.platform)).length;
                        previewText = `Will export ${count} use cases from ${selected.length} platform(s)`;
                    } else {
                        previewText = 'Select at least one platform';
                    }
                } else if (exportType === 'individual') {
                    const selected = Array.from(document.querySelectorAll('.use-case-list input:checked'));
                    count = selected.length;
                    if (count > 0) {
                        previewText = `Will export ${count} use case(s) as individual files`;
                    } else {
                        previewText = 'Select at least one use case';
                    }
                }
                
                preview.textContent = previewText;
            }

            /**
             * Execute export
             */
            async executeExport() {
                const exportType = document.querySelector('input[name="export-type"]:checked').value;
                const prettify = document.getElementById('export-prettify').checked;
                
                try {
                    let exportCount = 0;
                    
                    if (exportType === 'all') {
                        const useCases = Array.from(this.useCases.values());
                        const jsonString = JSON.stringify(useCases, null, prettify ? 2 : 0);
                        this.downloadJSON(jsonString, `wazuh-all-usecases-${this.getTimestamp()}.json`);
                        exportCount = useCases.length;
                    }
                    
                    this.closeExportModal();
                    this.showToast(`Exported ${exportCount} use case(s) successfully!`, 'success');
                    
                } catch (error) {
                    console.error('Export error:', error);
                    this.showToast(`Export failed: ${error.message}`, 'error');
                }
            }

            /**
             * Download JSON file
             */
            downloadJSON(jsonString, filename) {
                const blob = new Blob([jsonString], { type: 'application/json;charset=utf-8' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = filename;
                link.click();
                URL.revokeObjectURL(link.href);
            }

            /**
             * Get timestamp
             */
            getTimestamp() {
                return new Date().toISOString().split('T')[0];
            }

            /**
             * Import data
             */
            async importData() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                input.multiple = true;
                
                input.onchange = async (e) => {
                    const files = Array.from(e.target.files);
                    if (files.length === 0) return;
                    
                    let totalImported = 0;
                    
                    for (const file of files) {
                        try {
                            const content = await this.readFileAsText(file);
                            const data = JSON.parse(content);
                            
                            const useCases = Array.isArray(data) ? data : [data];
                            
                            for (const uc of useCases) {
                                if (uc.id && uc.name) {
                                    await this.saveUseCase(uc);
                                    totalImported++;
                                }
                            }
                        } catch (error) {
                            console.error(`Error importing file ${file.name}:`, error);
                        }
                    }
                    
                    await this.renderFileTree();
                    await this.updateDashboard();
                    this.showToast(`Imported ${totalImported} use case(s)`, 'success');
                };
                
                input.click();
            }

            /**
             * Read file as text
             */
            readFileAsText(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => resolve(e.target.result);
                    reader.onerror = reject;
                    reader.readAsText(file);
                });
            }

            /**
             * Search use cases
             */
            searchUseCases(query) {
                const lowerQuery = query.toLowerCase();
                
                document.querySelectorAll('.tree-item').forEach(item => {
                    const text = item.textContent.toLowerCase();
                    item.style.display = text.includes(lowerQuery) ? 'flex' : 'none';
                });
                
                if (this.currentTab === 'dashboard') {
                    const groups = document.querySelectorAll('.platform-group');
                    
                    groups.forEach(group => {
                        const rows = group.querySelectorAll('tbody tr');
                        let visibleCount = 0;
                        
                        rows.forEach(row => {
                            const text = row.textContent.toLowerCase();
                            if (text.includes(lowerQuery) || !query) {
                                row.style.display = '';
                                visibleCount++;
                            } else {
                                row.style.display = 'none';
                            }
                        });
                        
                        group.style.display = visibleCount > 0 ? '' : 'none';
                    });
                }
            }

            /**
             * Show toast notification
             */
            showToast(message, type = 'info') {
                const toast = document.getElementById('toast');
                toast.textContent = message;
                toast.className = `toast show ${type}`;
                
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }
        }

        // Initialize app
        window.app = new WazuhSOCApp();
        console.log('üöÄ Wazuh SOC Manager loaded successfully!');
    </script>
</body>
</html>